{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022-04-06-aws-mfa-on-powershell/","result":{"data":{"site":{"siteMetadata":{"title":"The Plastic Neuron"}},"markdownRemark":{"id":"7d7ed83a-d242-5ac2-9d75-75d902fd4412","excerpt":"Securing your AWS IAM account with MFA is a really good idea. However, if you’re not careful, the AWS IAM policy might stop you from using the AWS Powershell…","html":"<p>Securing your AWS IAM account with MFA is a really good idea. However, if you’re not careful, the AWS IAM policy might stop you from using the AWS Powershell toolkit. This post is an <a href=\"https://en.wikipedia.org/wiki/Aide-m%C3%A9moire\">aide mémoire</a>.</p>\n<p>In IAM, you set policies that control access to resources. To force MFA, you might add a policy that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Don't blindly copy this, there's a problem here\r\n{\r\n    \"Version\": \"2012-10-17\",\r\n    \"Statement\": [\r\n        {\r\n            \"Sid\": \"BlockAnyAccessOtherThanAboveUnlessSignedInWithMFA\",\r\n            \"Effect\": \"Deny\",\r\n            \"NotAction\": \"iam:*\",\r\n            \"Resource\": \"*\",\r\n            \"Condition\": {\r\n                \"BoolIfExists\": {\r\n                    \"aws:MultiFactorAuthPresent\": \"false\"\r\n                }\r\n            }\r\n        }\r\n    ]\r\n}</code></pre></div>\n<p>On the surface, this seems sensible. You <strong>Deny</strong> access to all <code class=\"language-text\">Resource</code> that isn’t <code class=\"language-text\">iam</code> if multi-factor authentication is not present. It’s a mouthful but the logic is sound.</p>\n<blockquote>\n<p>You need access to IAM to login at all, so you can’t deny that</p>\n</blockquote>\n<p><a href=\"https://aws.amazon.com/premiumsupport/knowledge-center/mfa-iam-user-aws-cli/\">https://aws.amazon.com/premiumsupport/knowledge-center/mfa-iam-user-aws-cli/</a></p>","frontmatter":{"title":"Setting IAM Policy that forces MFA use on the command line","date":"April 06, 2022","description":null}},"previous":{"fields":{"slug":"/2019-02-07-brighter-dotnetcorelinuxdaemon/"},"frontmatter":{"title":"Brighter Servicehost as a .NET Core 2.x linux daemon with RabbitMQ"}},"next":{"fields":{"slug":"/2022-10-31-aws-msk-dotnet/"},"frontmatter":{"title":"Connecting .NET to AWS Kafka (MSK)"}}},"pageContext":{"id":"7d7ed83a-d242-5ac2-9d75-75d902fd4412","previousPostId":"d6950356-4882-555f-9d3a-d638c275b5ed","nextPostId":"4b374aa5-6d02-5dac-8115-63dc9f06cc6b"}},"staticQueryHashes":["2841359383","69202846"]}