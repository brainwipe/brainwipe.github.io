{"componentChunkName":"component---src-templates-blog-post-js","path":"/2017-05-23-docker-linux-dotnet/","result":{"data":{"site":{"siteMetadata":{"title":"The Plastic Neuron"}},"markdownRemark":{"id":"d106f7d3-37e3-5b14-8282-40367852d4e5","excerpt":"In this post I’m going to take you through getting a .NET Core running on Linux docker container. I’m not an expert and will refer back to the Bad Old Days (BOD…","html":"<p>In this post I’m going to take you through getting a .NET Core running on Linux docker container. I’m not an expert and will refer back to the Bad Old Days (BOD) a lot.</p>\n<h2>Pre-requisites</h2>\n<p>You might find alternatives to these tools but they are the ones that my team and I use. Before you install, make sure you <a href=\"https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install\">understand the caveats from docker</a>.</p>\n<ul>\n<li>Windows 10 Pro x64, Microsoft Hyper-V</li>\n<li>Visual Studio 2017</li>\n</ul>\n<h2>Install Docker for Windows</h2>\n<p><a href=\"https://docs.docker.com/docker-for-windows/install/#download-docker-for-windows\">Download Docker for Windows</a> I recommend the stable channel. I used the defaults for everything, I suggest you do too!</p>\n<p>Once docker for Windows is installed, find the docker whale icon in the status bar right click and choose <code class=\"language-text\">Settings...</code>. On the left of the settings window, choose <code class=\"language-text\">Shared Drives</code> and tick the box for <code class=\"language-text\">C:</code>. This will give the docker machine access to the files on the <code class=\"language-text\">C:</code> drive, which is doesn’t have by default.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACUUlEQVR42p2T7WvTUBTGr4igH3SKf48wmIr/kJ/8IKLgfJ1TxKFDbQsKMnE61FYRZAMF54c5N1ZqaZc0L03SNG9Nmya5eTy5nW9DKnjhx7lJOM95zrk3rCW14Hct8OEAPOqLmKUxwFNBxhOKHDwZIiN+xCyJf2OIfIV6E6xab6AqaZBNB03dhukG8DwPkiRBURTIsgxd1/G3lWWZiJKs4NHiO4QdE6y0vIkHy1UUP9RR/CTjbdWAT4JyS4amqjAMA5ZliSK+78NxHARB8Ifg0xUVp+e34OkaWKPRxLemBKPThWF34fo9RFEkknOROI6pY44kSYhUxDRNhdhIMEPXG0D3MsQ2CaryNrWkIewFCHwPg34fMSWZ5GowiCiZ7wiNiOMEruNS0aHYDwmeJqMZmi2wtqbCtm3hyHVdhGEoHPRJOBcYN7vdz/1cUKVZ5W5yoXw2I0GOXTnj109BBay13RSnaZomDCIXTMhhLprS7ET8F9QJz1s28pZVBe22AU3TCJUEe+IQ/sfhIHeoKTLNzhPOfD8Ql/r9ag1nZ5/g4p0FXJl/gdnCa9wqlXGTELFYFu8u31ui70u4dHcRF+aeo/Z1Hczvduje+YQLu2OLStMzj8H2HcPeo6fAJo6DHSKOnPzFYWLiBNj+SbADk9hzcIr2Uyg/ewVmORacoCfunxuE4BnHx/Umzs29xPT9Cq4+rGCmWMG1QllwvVDZiWXcKL0RnL+9gDPUkXBY31iBWl2DuvUFZn0TrlxD1NExpEIR/eOpZwG98bRra5A2PsOrruI7bJ6oqrwckMQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The Docker Settings window showing the shared drive and the C drive ticked\"\n        title=\"\"\n        src=\"/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png\"\n        srcset=\"/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/c26ae/docker-settings-share-drive.png 158w,\n/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/6bdcf/docker-settings-share-drive.png 315w,\n/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png 630w,\n/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/40601/docker-settings-share-drive.png 945w,\n/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/78612/docker-settings-share-drive.png 1260w,\n/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png 1670w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Why did I need Hyper-V?</h2>\n<p>That was a question I found myself asking at first. Where Docker is the application that is running in your system tray, the virtual machine that hosts the actual docker container is in Hyper-V. Let’s have a look at that.</p>\n<p>In Windows hit the windows key and type <code class=\"language-text\">Hyper-V</code> to get the Hyper-V Manager. You’ll see this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1533b470897f6f55826751f12491ab25/d438d/hyper-v-docker.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAB2HAAAdhwGP5fFlAAABiklEQVR42pVSa2+DMAzk//+2qZ8qdVsppWxAIAkJb8rr5oQWdV21bpaOOJZ99sU4PGHgPAETGsPQY54mTONwg3E959VfME8j6ANM5APoRAhnczhhewjgxTmUzuH5J6RcQCoFkWXgUkJIOinGhVxjSmt4pxDbPdWGKTymsd/t4CSUoKoO4zSDqwze0UOuFRT5mkiLXEMRAU8TGzexuirRdw3cIMbL9gD3gyOQHdzXdzhNXeFqdV1btG2LfhjwzFRRIJMchc7svZOMCKvvhF3X4Xw+Y6T3emaCVKScQwgOk93eE2p6F98/Io4jJHZZqYUpMEhJdpZJVCS5JmWcxUiTxA7wcMKCJDAWUUGOqixQEiRJYtTAEJaXWF2XaJqKyCLKj1fCVsT3khv0fW/9eZ4tJvMbXXCNGVjJGZE3jcm294ZH95IVdWXLdEVuYTZrptb0XtfYirJcyC8Nfkg22zWT3NqSP69T3JpZ4L8Jf7OHhNzboYhPyCMfMnChw6P1/wL16dnaklDRQuTbBl+x6J1tg6O+GAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The Hyper-V manager with one VM running\"\n        title=\"\"\n        src=\"/static/1533b470897f6f55826751f12491ab25/f058b/hyper-v-docker.png\"\n        srcset=\"/static/1533b470897f6f55826751f12491ab25/c26ae/hyper-v-docker.png 158w,\n/static/1533b470897f6f55826751f12491ab25/6bdcf/hyper-v-docker.png 315w,\n/static/1533b470897f6f55826751f12491ab25/f058b/hyper-v-docker.png 630w,\n/static/1533b470897f6f55826751f12491ab25/40601/hyper-v-docker.png 945w,\n/static/1533b470897f6f55826751f12491ab25/78612/hyper-v-docker.png 1260w,\n/static/1533b470897f6f55826751f12491ab25/d438d/hyper-v-docker.png 2290w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>There’s only one Virtual Machine (VM) running called <strong>MobyLinuxVM</strong>. It’s called Moby because docker is now a trademark used by the support company and <a href=\"https://blog.docker.com/2017/04/introducing-the-moby-project/\">Moby</a> is the name given to the open source bit. Moby Linux is an alpine distro of Linux with addition to allow communication between the virtual machine and Hyper-V.</p>\n<p>The default IP of the docker host virtual machine is 10.0.75.1. That will come in useful later.</p>\n<h2>New ASP.NET Core Project</h2>\n<p>Open up Visual Studio 2017 and create an ASP.NET Core Web Application. Select <code class=\"language-text\">Enable Docker Support</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f1a727cee004332a2abe8b85d52fc77d/098c1/aspnet-core-with-docker.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACAklEQVR42oWTaY6jMBCFuf9p5gTzd6TekwATmog9Zjc2O+kkb8ruZJaejrqkpzLIfK5yPYxiH4ElMcqMoUgZUpYiz1LwMkeh3mV7WheYxx7LNOBtmXBcZp2v6wO9P7wd0XgWjMj34AcB9oyhrGokuUA/HTBNE4ZxfNcwoOt7yLZFHMcIaH8QhL+z73nISo7as2FkLIFl22iaBuv1CkJw7JME8zzjY6hDVs/PWL28wNyYWpZlUV5j6+6QWI8wOtmAUZvLssCjk9q2w93dPYGFhpzP/wJ3UQqPJEQDKaTeJ6gY0Y8o3A2Mqe/05tP5pLMCl2WpP/4YqmreEEC2f2AXoBxGlDu6w2noL5Wc8VUooK7mCvob2Cug+TnwFlwBpZTouk5Lrf8HXls+nTTollSMdA0xDSyKIoRhiDzPNfjLCm+FulfHcWBbNkzThOu6NFCGuqpoKAMNhYA1GbjmHFyrRtu16Mlzync9rVvynryoofayLNNK0xS+72tnlGR80Q3IX2nKWRJpbz08rfCw3mKz9RGEMdg+QcJy+rhARVNXqquS2uM0YaHVtVIfKqkQScBS2UadXImWnF4jrxuklFlRUeZgnDbJAe0wkS0mbQ11V0riIt6NaFr6i+YjSt+BofquQxdc6xU8ct9Fz03ooA4cVP7nKjwH1tM97EfSww/8/P4NvwCzlNhaNBP7AQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Creating a new ASP.NET Core project with docker support\"\n        title=\"\"\n        src=\"/static/f1a727cee004332a2abe8b85d52fc77d/f058b/aspnet-core-with-docker.png\"\n        srcset=\"/static/f1a727cee004332a2abe8b85d52fc77d/c26ae/aspnet-core-with-docker.png 158w,\n/static/f1a727cee004332a2abe8b85d52fc77d/6bdcf/aspnet-core-with-docker.png 315w,\n/static/f1a727cee004332a2abe8b85d52fc77d/f058b/aspnet-core-with-docker.png 630w,\n/static/f1a727cee004332a2abe8b85d52fc77d/40601/aspnet-core-with-docker.png 945w,\n/static/f1a727cee004332a2abe8b85d52fc77d/78612/aspnet-core-with-docker.png 1260w,\n/static/f1a727cee004332a2abe8b85d52fc77d/098c1/aspnet-core-with-docker.png 1578w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Once complete, you can run it straight away by pressing F5. You’ll notice that the output window from the build has lots more output in it. That’s the docker compose system.</p>\n<p>If you need to add docker support to an existing solution, you can do that by adding the docker compose project</p>\n<h2>Target process exited without raising a CoreCLR started event</h2>\n<p>At first I saw this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f16cc92492103016b7cb0bf67e563ca4/0955e/netcore-did-not-start.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABR0lEQVR42p2Q627aQBCF/ah5x75EI1VFhdhgG7KBEl9xDPZefP+yJrR/EkVNR/p0Zs/OSKPjpCIkOjwRHwSJ1WexIzv+Zmw0g1H/TKcl5VHgNLKiGya6vv9LPwz8T3XyjDO2HVO/Z+hqlNLUdY2UEq3VVauqoq7evBml3vza+tLOXuct8yGjrnGmtqc+3KFP3/CDCM99YLNe4/sbVqsV/sYnCAKEEHieh+u6bLc7xOMj6/nP9wmDkPxUQKNwhkbCdKZvLyRJSp5nxHFs+/iq8zuKIrI0u3kJhV0uy5KT1TRNKYqCfhwZ5gvn8P/UNE0fh2P96bPwbnuDrnBM9ULbNrSNeY8xH/s3jNZIm6nSBmUaVJnjnF8KLspwkfpLVHYnjAoWwZ7vS5+lSNgfI5xs/ZN855Fv3S9z8H6xW/4gXNwjHhYcl/e8AjyKrHPj6HkwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Process exited without raising a CoreCLR started event\"\n        title=\"\"\n        src=\"/static/f16cc92492103016b7cb0bf67e563ca4/f058b/netcore-did-not-start.png\"\n        srcset=\"/static/f16cc92492103016b7cb0bf67e563ca4/c26ae/netcore-did-not-start.png 158w,\n/static/f16cc92492103016b7cb0bf67e563ca4/6bdcf/netcore-did-not-start.png 315w,\n/static/f16cc92492103016b7cb0bf67e563ca4/f058b/netcore-did-not-start.png 630w,\n/static/f16cc92492103016b7cb0bf67e563ca4/0955e/netcore-did-not-start.png 901w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In Visual Studio check the Debug output window for the reason why:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">realpath(): Invalid argument\r\nThe specified framework 'Microsoft.NETCore.App', version '1.1.2' was not found.\r\n  - Check application dependencies and target a framework version installed at: /usr/share/dotnet/shared/Microsoft.NETCore.App\r\n  - The following versions are installed:\r\n  1.1.1\r\n  - Alternatively, install the framework version '1.1.2'.\r\nThe program '' has exited with code 131 (0x83).</code></pre></div>\n<p>Installing the latest version of .NET Core will solve this problem but why is it happening? Let’s look at…</p>\n<h2>The Dockerfile</h2>\n<p>In your ASP.NET Core project you’ll find a Dockerfile (no file extension). The Dockerfile is a build file for creating a docker image. Each line is a command. It will look a little like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM microsoft/aspnetcore:1.1\r\nARG source\r\nWORKDIR /app\r\nEXPOSE 80\r\nCOPY ${source:-obj/Docker/publish} .\r\nENTRYPOINT [\"dotnet\", \"AspNetCoreInDocker.dll\"]</code></pre></div>\n<p>The first line <code class=\"language-text\">microsoft/aspnetcore:1.1</code> is the base image. The name breaks down as <code class=\"language-text\">[maintainer]/[image]:[tag]</code>. So this is an image that’s maintained by Microsoft, has ASP.NET Core on it and has the version tag of 1.1. You can find all the tags on the <a href=\"https://hub.docker.com/r/microsoft/aspnetcore/\">Docker Hub page for this image</a>. You can use <code class=\"language-text\">FROM microsoft/aspnetcore:latest</code> to get yourself running. (<a href=\"https://stackoverflow.com/questions/44134429/why-does-latest-aspnet-core-docker-image-run-when-the-tag-1-1-fails\">I’ve started a Stack Overflow question to understand why</a>).</p>\n<p>Run the solution again and a browser window will open with the default ASP.NET Core project being shown. .NET is now running in a Linux docker container on a Linux host.</p>","frontmatter":{"title":".NET running on a Linux docker container","date":"May 23, 2017","description":null}},"previous":{"fields":{"slug":"/2017-05-17-linux-wsl/"},"frontmatter":{"title":"A .NET codger getting into Linux on Windows"}},"next":{"fields":{"slug":"/2017-06-19-datagrip-localdb-connect/"},"frontmatter":{"title":"DataGrip - File not found when connecting to LocalDB"}}},"pageContext":{"id":"d106f7d3-37e3-5b14-8282-40367852d4e5","previousPostId":"3ba1181a-63ba-5fdf-b7c7-9b48a05ac681","nextPostId":"a9b3b76f-6721-5dbc-bc3c-4a3df8510947"}},"staticQueryHashes":["2841359383","69202846"],"slicesMap":{}}