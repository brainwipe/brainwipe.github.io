<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Rob Lang's Blog RSS Feed]]></title><description><![CDATA[Mostly an aide memoire for future-me to remember how I solved various problems.]]></description><link>https://brainwipe.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 23 Nov 2022 14:03:46 GMT</lastBuildDate><item><title><![CDATA[Find out what SQL queries are slow on PostgreSQL locally]]></title><description><![CDATA[Your cloud provider is showing you that some of your PostgreSQL queries are slow. Your cloud provider is showing you SQL, and you might have…]]></description><link>https://brainwipe.github.io/2022-11-23-postgresql-turn-on-stats/</link><guid isPermaLink="false">https://brainwipe.github.io/2022-11-23-postgresql-turn-on-stats/</guid><pubDate>Wed, 23 Nov 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Your cloud provider is showing you that some of your PostgreSQL queries are slow. Your cloud provider is showing you SQL, and you might have set &lt;a href=&quot;https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_PerfInsights.UsingDashboard.SQLTextSize.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;track_activity_query_size&lt;/code&gt;&lt;/a&gt; to something larger than 4096 bytes, so you can see your larger SQL statements.&lt;/p&gt;
&lt;p&gt;Now you want to reproduce locally but where can you get those statistics from?&lt;/p&gt;
&lt;p&gt;The process is much the same for Windows and other OSes but I’ll be doing it on Windows.&lt;/p&gt;
&lt;h2&gt;Switch on &lt;code class=&quot;language-text&quot;&gt;pg_stat_statements&lt;/code&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Find Postgres configuration file&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;psql &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;U postgres &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;c &lt;span class=&quot;token string&quot;&gt;&apos;SHOW config_file&apos;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# C:\Program Files\PostgreSQL\13\data\postgresql.conf # For Postgres 13 on Windows 10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Open the Postgres configuration file.&lt;/li&gt;
&lt;li&gt;Find &lt;code class=&quot;language-text&quot;&gt;shared_preload_libraries&lt;/code&gt;, it’s probably commented out&lt;/li&gt;
&lt;li&gt;Uncomment the line and change to:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;inf&quot;&gt;&lt;pre class=&quot;language-inf&quot;&gt;&lt;code class=&quot;language-inf&quot;&gt;shared_preload_libraries = &amp;#39;pg_stat_statements&amp;#39;	# (change requires restart)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Restart PostgreSQL&lt;/h2&gt;
&lt;p&gt;For the extension to be available, you need to restart the Postgres server. Use the data directory of your Postgres installation. For Postgres 13 on Windows 10:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;pg_ctl &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;D &lt;span class=&quot;token string&quot;&gt;&quot;C:\Program Files\PostgreSQL\13\data&quot;&lt;/span&gt; restart&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Restarting your computer will also work. You also have these commands for manual stop/start:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;pg_ctl &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;D &lt;span class=&quot;token string&quot;&gt;&quot;C:\Program Files\PostgreSQL\13\data&quot;&lt;/span&gt; stop
pg_ctl &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;D &lt;span class=&quot;token string&quot;&gt;&quot;C:\Program Files\PostgreSQL\13\data&quot;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Create extension in database&lt;/h2&gt;
&lt;p&gt;Open your favourite editor (I use &lt;a href=&quot;https://www.jetbrains.com/datagrip/&quot;&gt;DataGrip by Jetbrains&lt;/a&gt;), select your database and run the following query to switch on the stats creation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;CREATE&lt;/span&gt; EXTENSION pg_stat_statements&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Get basic statistics&lt;/h2&gt;
&lt;p&gt;From this point on, Postgres will start logging statistics on queries. To get at those queries, use:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; pg_stat_statements&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can now google for uses of &lt;code class=&quot;language-text&quot;&gt;pg_stat_statements&lt;/code&gt; to drill down for your specific needs.&lt;/p&gt;
&lt;h2&gt;Troubleshooting&lt;/h2&gt;
&lt;p&gt;If you see the error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;database&gt; CREATE EXTENSION pg_stat_statements
[2022-11-23 11:21:01] completed in 78 ms
database.public&gt; select * from pg_stat_statements
[2022-11-23 11:21:43] [55000] ERROR: pg_stat_statements must be loaded via shared_preload_libraries&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then it means you need to switch on &lt;code class=&quot;language-text&quot;&gt;pg_stat_statements&lt;/code&gt;, see above.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Troubleshooting Connecting .NET to MSK]]></title><description><![CDATA[In my previous blog post, I looked at connecting a .NET client to a Kafka cluster on MSK. To get to that point, I hit a lot of errors that…]]></description><link>https://brainwipe.github.io/2022-11-02-troubleshoot-aws-msk-dotnet/</link><guid isPermaLink="false">https://brainwipe.github.io/2022-11-02-troubleshoot-aws-msk-dotnet/</guid><pubDate>Wed, 02 Nov 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In my &lt;a href=&quot;../2022-10-31-aws-msk-dotnet&quot;&gt;previous blog post&lt;/a&gt;, I looked at connecting a .NET client to a Kafka cluster on MSK.&lt;/p&gt;
&lt;p&gt;To get to that point, I hit a lot of errors that weren’t immediately obvious what the cause was. Here’s how I troubleshooted them, I hope this is useful to you!&lt;/p&gt;
&lt;p&gt;Most of the issues I had was around ensuring that MSK was correctly configured to be both secure and… well, accessible!&lt;/p&gt;
&lt;h2&gt;Assumptions&lt;/h2&gt;
&lt;p&gt;Before we start, I assume that you have a .NET client running in a command line like the one in the &lt;a href=&quot;../2022-10-31-aws-msk-dotnet&quot;&gt;last blog post&lt;/a&gt; running but it doesn’t seem to connect to MSK.&lt;/p&gt;
&lt;h2&gt;Turn on debugging first!&lt;/h2&gt;
&lt;p&gt;A typical .NET client configuration looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    BootstrapServers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bootstrap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SecurityProtocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SecurityProtocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslCertificateLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.cer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslKeyLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.key&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Very little information will written out to the console, so you need to turn on debugging:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Debug &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;broker,protocol,metadata,topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Add Debugging Line&lt;/span&gt;
    BootstrapServers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bootstrap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SecurityProtocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SecurityProtocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslCertificateLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.cer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslKeyLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.key&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When running the client, you will see a huge amount of information. You might want to reduce or switch off for production.&lt;/p&gt;
&lt;h2&gt;Error: Terminating instance (destroy flags none (0x0))&lt;/h2&gt;
&lt;p&gt;Below is a debug output for mutual TLS. The output is from a C/C++ library called &lt;a href=&quot;https://www.nuget.org/packages/librdkafka.redist&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;librdkafka&lt;/code&gt;&lt;/a&gt;, which the .NET client binds to.&lt;/p&gt;
&lt;p&gt;There are two brokers (&lt;code class=&quot;language-text&quot;&gt;broker1-msk.amazonaws.com:9194/bootstrap&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;broker2-msk.amazonaws.com:9194/bootstrap&lt;/code&gt;) - your URLs will look a little different, I’ve adjusted mine to protect the innocent!&lt;/p&gt;
&lt;p&gt;The client is trying to connect via SSL to each broker (&lt;code class=&quot;language-text&quot;&gt;TRY_CONNECT -&gt; CONNECT&lt;/code&gt;). It keeps trying with &lt;code class=&quot;language-text&quot;&gt;Cluster connection already in progress: no cluster connection&lt;/code&gt; and eventually you see &lt;code class=&quot;language-text&quot;&gt;Terminating instance (destroy flags none (0x0))&lt;/code&gt;. The rest of the trace is client cleaning up after itself.&lt;/p&gt;
&lt;p&gt;This means that the client cannot &lt;em&gt;reach&lt;/em&gt; the MSK brokers.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BROKER&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Added new broker with NodeId &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BROKER&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Added new broker with NodeId &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Selected for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; bootstrap servers added &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;broker has &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; connection attempt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.106&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received CONNECT op
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.106&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state INIT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; TRY_CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.106&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker in state TRY_CONNECT connecting
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.106&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state TRY_CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.105&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.106&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;INIT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; librdkafka &lt;span class=&quot;token number&quot;&gt;v1.9.2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0x10902ff&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; initialized &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;builtin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;features gzip&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;snappy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;regex&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;lz4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_gssapi&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_plain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_scram&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;plugins&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;zstd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_oauthbearer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;oidc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SSL ZLIB SNAPPY ZSTD CURL SASL_SCRAM SASL_OAUTHBEARER PLUGINS HDRHISTOGRAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; debug &lt;span class=&quot;token number&quot;&gt;0x8e&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.117&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;37ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628222.146&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Connecting to ipv4&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; with socket &lt;span class=&quot;token number&quot;&gt;2744&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.145&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Selected for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;broker has &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; connection attempt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.145&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received CONNECT op
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.147&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state INIT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; TRY_CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.148&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker in state TRY_CONNECT connecting
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.148&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state TRY_CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.148&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;46ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.149&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;45ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628223.183&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Connecting to ipv4&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xxx&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; with socket &lt;span class=&quot;token number&quot;&gt;2816&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628224.178&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628225.222&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628226.284&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628227.329&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628228.381&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628229.419&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628230.454&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628231.501&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.461&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.538&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Cluster connection already in progress&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; no cluster connection
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.805&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;DESTROY&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Terminating instance &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;destroy flags none &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0x0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.806&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;DESTROY&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Destroy internal
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.806&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;DESTROY&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Removing all topics
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.806&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;DESTROY&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Sending TERMINATE to ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;DESTROY&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Sending TERMINATE to ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received TERMINATE op in state INIT&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Client is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;10702ms&lt;/span&gt; in state INIT&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state INIT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; DOWN
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKTERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; terminating&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker still has &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; buffer&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; partition&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received TERMINATE op in state CONNECT&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received TERMINATE op in state CONNECT&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERMINATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Handle is terminating in state DOWN&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; refcnts &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0000022DACAE1508&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; failed &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; request&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in retry&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;outbuf
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Client is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;10701ms&lt;/span&gt; in state CONNECT&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; DOWN
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Client is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;9658ms&lt;/span&gt; in state CONNECT&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; DOWN
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKTERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; terminating&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker still has &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; buffer&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; partition&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker handle is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;0ms&lt;/span&gt; in state DOWN&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.807&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKTERM&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; terminating&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker still has &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; refcnt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; buffer&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; partition&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.808&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERMINATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Handle is terminating in state DOWN&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; refcnts &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0000022DACAD8418&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; failed &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; request&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in retry&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;outbuf
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.808&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;TERMINATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Handle is terminating in state DOWN&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; refcnts &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0000022DAC23E208&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; active toppar&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; outbufs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; waitresps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; retrybufs&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; failed &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; request&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in retry&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;outbuf
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.808&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker handle is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;0ms&lt;/span&gt; in state DOWN&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1666628232.808&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;msk&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker handle is terminating &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;0ms&lt;/span&gt; in state DOWN&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_DESTROY&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Possible Causes&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;The port it’s using (9194) has not been added to the security group (firewall) for inbound traffic.&lt;/li&gt;
&lt;li&gt;You have not switched on public access. &lt;a href=&quot;https://docs.aws.amazon.com/msk/latest/developerguide/public-access.html&quot;&gt;Here’s how&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;system library:fopen:No such file or directory: fopen&lt;/h2&gt;
&lt;p&gt;This happens when the library cannot load the certificate that you have specified in your configuration. You get a similar error for an incorrect key file.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    SocketConnectionSetupTimeoutMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Debug &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;broker,protocol,metadata,topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    BootstrapServers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bootstrap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SecurityProtocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SecurityProtocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslCertificateLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TYPOkafka_test_client.cer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// TYPO here&lt;/span&gt;
    SslKeyLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.key&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391346.010&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;SSL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; crypto\bio\bss_file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;288&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;02001002&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;system library&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;fopen&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;No such file or directory&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; fopen&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;TYPOkafka_test.cer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;rb&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391346.010&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;SSL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; crypto\bio\bss_file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;290&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20074002&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;BIO routines&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;file_ctrl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;system lib
&lt;span class=&quot;token property&quot;&gt;System.InvalidOperationException:&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;ssl.certificate.location failed:&lt;/span&gt; ssl\ssl_rsa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;140DC002&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;SSL routines&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;use_certificate_chain_file&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;system lib
  at SafeKafkaHandle Confluent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Impl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SafeKafkaHandle&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Create&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;RdKafkaType type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IntPtr config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IClient owner&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at Confluent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Producer`&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ctor&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ProducerBuilder&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;TKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TValue&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; builder&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at Confluent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AdminClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ctor&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;AdminClientBuilder builder&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at IAdminClient Confluent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AdminClientBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Build&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at void MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commands&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;KafkaCommand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ListTopics&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Commands\KafkaCommand.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;61&lt;/span&gt;
  at async ValueTask MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commands&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;KafkaCommand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ExecuteAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;IConsole console&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Commands\KafkaCommand.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;40&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ExecuteCommand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Middleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CheckZoneMiddleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Middleware\CheckZoneMiddleware.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;BindInput&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleSpecialOptions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ExecuteDirectivesSubpipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;InitializeDirectives&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Pipeline&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ResolveCommandSchemaAndInstance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Middleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TimeTravelMiddleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Middleware\TimeTravelMiddleware.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;46&lt;/span&gt;
  at async Task MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Middleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CliTenantMiddleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Middleware\CliTenantMiddleware.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt;
  at async Task MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Middleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;LogLevelMiddleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Middleware\LogLevelMiddleware.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;
  at async Task MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CLI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Middleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;McoInitialisingMiddleware&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;HandleAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ICliContext context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CommandPipelineHandlerDelegate next&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CancellationToken cancellationToken&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; in &lt;span class=&quot;token file-path string&quot;&gt;C:\Projects\MCO\MCO.CLI\Middleware\McoInitialisingMiddleware.cs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;
  at async Task Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CliCommandExecutor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RunPipelineAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;IServiceProvider serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ICliContext context&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
  at async Task&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;int&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Typin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Internal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CliCommandExecutor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ExecuteCommandAsync&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;IEnumerable&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;string&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; commandLineArguments&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;SSL routines:ssl3_read_bytes:sslv3 alert bad certificate&lt;/h2&gt;
&lt;p&gt;This happens when your key file was not configured at all.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    SocketConnectionSetupTimeoutMs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Debug &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;broker,protocol,metadata,topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    BootstrapServers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bootstrap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SecurityProtocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SecurityProtocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslCertificateLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.cer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// SslKeyLocation = &quot;kafka_test_client.key&quot; // Key file is not configured!&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.595&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;internal&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.595&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BROKER&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Added new broker with NodeId &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.595&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.595&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BROKER&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Added new broker with NodeId &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Selected for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; bootstrap servers added &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;broker has &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; connection attempt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;BRKMAIN&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Enter main broker thread
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;INIT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; librdkafka &lt;span class=&quot;token number&quot;&gt;v1.9.2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0x10902ff&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; initialized &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;builtin&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;features gzip&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;snappy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;regex&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;lz4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_gssapi&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_plain&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_scram&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;plugins&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;zstd&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;sasl_oauthbearer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;oidc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SSL ZLIB SNAPPY ZSTD CURL SASL_SCRAM SASL_OAUTHBEARER PLUGINS HDRHISTOGRAM&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; debug &lt;span class=&quot;token number&quot;&gt;0x8e&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received CONNECT op
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state INIT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; TRY_CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker in state TRY_CONNECT connecting
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.596&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state TRY_CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.606&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;39ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.621&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Connecting to ipv4&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token ip-address constant&quot;&gt;3.8.254.176&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; with socket &lt;span class=&quot;token number&quot;&gt;2548&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.655&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Connected to ipv4&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token ip-address constant&quot;&gt;3.8.254.176&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.656&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; SSL_HANDSHAKE
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.656&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Selected for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;broker has &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; connection attempt&lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Received CONNECT op
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state INIT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; TRY_CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; broker in state TRY_CONNECT connecting
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;STATE&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Broker changed state TRY_CONNECT &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; CONNECT
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;49ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.657&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Not selecting any broker for cluster connection&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; still suppressed for &lt;span class=&quot;token number&quot;&gt;49ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; application metadata request
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.678&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;CONNECT&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Connecting to ipv4&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token ip-address constant&quot;&gt;18.169.67.207&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; with socket &lt;span class=&quot;token number&quot;&gt;2584&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.691&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; SSL handshake failed&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl\record\rec_layer_s3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1544&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;14094412&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;SSL routines&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl3_read_bytes&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;sslv3 alert bad certificate&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; SSL alert number &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;34ms&lt;/span&gt; in state SSL_HANDSHAKE&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;_SSL&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1667391595.691&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;FAIL&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;rdkafka&lt;span class=&quot;token operator&quot;&gt;#&lt;/span&gt;producer&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;thrd&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;broker2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eu&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amazonaws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9194&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bootstrap&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; SSL handshake failed&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ssl\record\rec_layer_s3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1544&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; error&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;14094412&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;SSL routines&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;ssl3_read_bytes&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;sslv3 alert bad certificate&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; SSL alert number &lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;(&lt;/span&gt;after &lt;span class=&quot;token number&quot;&gt;34ms&lt;/span&gt; in state SSL_HANDSHAKE&lt;span class=&quot;token operator&quot;&gt;)&lt;/span&gt;

Logs repeat&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Connecting .NET to AWS Kafka (MSK)]]></title><description><![CDATA[This guide looks at connecting a .NET Core client to an AWS Kafka (MSK) cluster using Mutual TLS. We’re going to focus on the mutual TLS…]]></description><link>https://brainwipe.github.io/2022-10-31-aws-msk-dotnet/</link><guid isPermaLink="false">https://brainwipe.github.io/2022-10-31-aws-msk-dotnet/</guid><pubDate>Mon, 31 Oct 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This guide looks at connecting a .NET Core client to an AWS Kafka (MSK) cluster using Mutual TLS. We’re going to focus on the mutual TLS authentication, how to make certificates, a CA and certificate requests.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WARNING: You will be charged by AWS.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Much of the instructions below will include a charge by AWS. That’s my only warning.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;../2022-10-31-aws-msk-dotnet&quot;&gt;Companion troubleshooting blog here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Pre-requisites&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt; &lt;a href=&quot;https://wiki.openssl.org/index.php/Binaries&quot;&gt;Windows binaries here&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://aws.amazon.com/cli/&quot;&gt;AWS CLI access&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;AWS API and Kafka Connections&lt;/h2&gt;
&lt;p&gt;The first aspect to wrap your head around is that there are two API. AWS MSK and Confluent Kafka.&lt;/p&gt;
&lt;p&gt;AWS MSK is for managing the cluster itself and needs IAM permissions. You use the &lt;a href=&quot;https://www.nuget.org/packages/AWSSDK.Kafka/&quot;&gt;AWSSDK.Kafka nuget package&lt;/a&gt; for that. That package will &lt;strong&gt;not&lt;/strong&gt; let you connect to the Kafka brokers themselves. Only for cluster admin.&lt;/p&gt;
&lt;p&gt;Confluent Kafka is for producing/consuming messages to/from the Kafka queue itself. You use the &lt;a href=&quot;https://www.nuget.org/packages/Confluent.Kafka/&quot;&gt;Confluent.Kafka nuget package&lt;/a&gt; for that.&lt;/p&gt;
&lt;p&gt;If you’re not going to be administering the AWS MSK cluster through code then you don’t need the AWSSDK!&lt;/p&gt;
&lt;h2&gt;Not covering generic Kafka use&lt;/h2&gt;
&lt;p&gt;There are lots of guides on how to use Confluent.Kafka to connect to a Kafka cluster from .NET. I liked &lt;a href=&quot;https://awswith.net/2020/11/01/developing-net-core-applications-for-apache-kafka-and-amazon-msk/&quot;&gt;Developing .NET Core Applications for Apache Kafka and Amazon MSK&lt;/a&gt; although it is very light on the detail on the MSK part.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.confluent.io/kafka-clients/dotnet/current/overview.html&quot;&gt;The official documentation&lt;/a&gt; is also good but leans heavily on Confluent’s own cloud.&lt;/p&gt;
&lt;h2&gt;Create an AWS Private Certificate Authority&lt;/h2&gt;
&lt;p&gt;A &lt;a href=&quot;https://www.digicert.com/blog/what-is-a-certificate-authority&quot;&gt;certificate authority&lt;/a&gt; (CA) is usually a company or organisation that validates websites, emails and so on. A &lt;em&gt;private&lt;/em&gt; certificate authority is where &lt;em&gt;you&lt;/em&gt; are the organisation doing the validating (through AWS) for your own services inside AWS.&lt;/p&gt;
&lt;p&gt;You can use certificates issued by &lt;a href=&quot;https://www.verisign.com/en_US/website-presence/online/ssl-certificates/index.xhtml&quot;&gt;Verisign&lt;/a&gt; or &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;LetsEncrypt&lt;/a&gt; or some other issuer but in this case it’s your AWS service and your client, so you can trust you. If any third party wants to use it, you can send the certificate to them. We’ll come onto that later.&lt;/p&gt;
&lt;p&gt;The MSK cluster is going to use that certificate authority in two ways:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;It’s going to authenticate clients using it.&lt;/li&gt;
&lt;li&gt;It’s going to let clients authenticate it.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;(that’s why it’s &lt;a href=&quot;https://www.cloudflare.com/en-gb/learning/access-management/what-is-mutual-tls/&quot;&gt;mutual transport layer security&lt;/a&gt;, both sides have to authenticate that they know who they are)&lt;/p&gt;
&lt;h3&gt;Steps&lt;/h3&gt;
&lt;p&gt;To create a private CA, go to &lt;a href=&quot;https://eu-west-2.console.aws.amazon.com/acm-pca/home?region=eu-west-2#/firstrunscreen&quot;&gt;AWS’s Private Certificate Authority&lt;/a&gt; (beware the link is to eu west 2 region).&lt;/p&gt;
&lt;p&gt;Settings:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Type: Root&lt;/li&gt;
&lt;li&gt;O,OU,C,CN, etc: set these sensibly for your company&lt;/li&gt;
&lt;li&gt;Key algorithm: RSA 2048 is fine at time of writing&lt;/li&gt;
&lt;li&gt;Certificate revocation options: none - they don’t work with Kafka. You use Kafka Access Control Lists (ACLs) to control revocation instead.&lt;/li&gt;
&lt;li&gt;CA permissions options: Check&lt;/li&gt;
&lt;li&gt;Pricing: ⚠ Check (it’s going to cost!)&lt;/li&gt;
&lt;li&gt;Click Create CA.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That’s it. Click through to your certificate and make a note of the new private certificate authority Amazon Resource Name (ARN). Being the root of a certificate chain, the Certificate Authority has a special role but it’s just a certificate like any other. It will look something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-----BEGIN CERTIFICATE-----
MIIEKjCCAxKgAwIBAgIQaEuWKnMW5/K/++B9NulGxTANBgkqhkiG9w0BAQsFADCB
hTELMAkGA1UEBhMCR0IxHTAbBgNVBAoMFE15IENsaW5pY2FsIE91dGNvbWVzMRQw
HQOr3V2CW1z6Idh6RS4=
-----END CERTIFICATE-----&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(Not a real certificate, just me banging the keyboard).&lt;/p&gt;
&lt;h2&gt;Export, convert the Private CA&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Optional step!&lt;/strong&gt; The Private CA certificate is included in the signed certificate from AWS, the client should use it. If you find that the SSL handshake fails, then convert and install the Private CA as below.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The .NET client needs to make sure that the Kafka server it is talking to is the right one. If you’re using a Private CA then you will need to install it in the Windows Certificate store on every computer that needs a connection to Kafka (including giving it to 3rd parties if others are connecting to it).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Log into the AWS Console.&lt;/li&gt;
&lt;li&gt;Find your Private CA, click Actions-&gt;Get CA Certificate&lt;/li&gt;
&lt;li&gt;Click “Export certificate body to a file”&lt;/li&gt;
&lt;li&gt;A file called &lt;code class=&quot;language-text&quot;&gt;Certificate.pem&lt;/code&gt; is downloaded.&lt;/li&gt;
&lt;li&gt;Rename the file &lt;code class=&quot;language-text&quot;&gt;kafka_private_ca.pem&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The .NET client needs this certificate installed into the “Trusted Root Store” of the Certificate Manager. But &lt;code class=&quot;language-text&quot;&gt;.pem&lt;/code&gt; files are not supported, we need to convert it using &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open Powershell to &lt;code class=&quot;language-text&quot;&gt;kafka_private_ca.pem&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Use &lt;code class=&quot;language-text&quot;&gt;openssl&lt;/code&gt; to convert it to pkcs12 format:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;openssl pkcs12 &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;export &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;out kafka_private_ca&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;p12 &lt;span class=&quot;token operator&quot;&gt;-in&lt;/span&gt; kafka_private_ca&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pem &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;nokeys&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Add an export password and make a note of it, you will need it to install it&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NB: We need to use &lt;code class=&quot;language-text&quot;&gt;-nokeys&lt;/code&gt; because there are no private keys in the PEM file, openssl doesn’t know that unless we tell it.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In windows explorer, double click the &lt;code class=&quot;language-text&quot;&gt;kafka_private_ca.p12&lt;/code&gt; and then go through the Certificate Import Wizard.&lt;/li&gt;
&lt;li&gt;Store Location: Local Machine&lt;/li&gt;
&lt;li&gt;File to Import: path should be to kafka_private_ca.p12&lt;/li&gt;
&lt;li&gt;Password: that you just set on &lt;code class=&quot;language-text&quot;&gt;openssl pkcs12 export&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Automatically detect store&lt;/li&gt;
&lt;li&gt;Next and Finish.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The AWS Private CA will now be installed on this computer. You will need to repeat the process for any computer you’re using it on. If a 3rd party wants to connect to your client, they will need this certificate too.&lt;/p&gt;
&lt;h2&gt;Create a Client Certificate&lt;/h2&gt;
&lt;p&gt;MSK needs to know that the client is authenticated to make calls. For that, the client needs it’s own certificate. Here are the steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a new certificate called a client certificate with a signing request&lt;/li&gt;
&lt;li&gt;Use the signing request to ask the Private CA on AWS to sign the client certificate&lt;/li&gt;
&lt;li&gt;Get the newly signed client certificate from AWS&lt;/li&gt;
&lt;li&gt;Convert the newly signed client certificate into a format that the .NET Kafka client can use&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Create a new client certificate and signing request&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;In PowerShell&lt;/li&gt;
&lt;li&gt;Create new certificate with signing request:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;openssl req &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;newkey rsa:2048 &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;nodes &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;keyout kafka_test_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;out kafka_test_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csr&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That will generate the key first:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Generating a RSA private key
........................................................................................................................................................+++++
.......................+++++
writing new private key to &apos;kafka_test_client.key&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then ask you to fill in details for the certificate request:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:UK
State or Province Name (full name) [Some-State]:London
Locality Name (eg, city) []:London
Organization Name (eg, company) [Internet Widgits Pty Ltd]:My Company
Organizational Unit Name (eg, section) []:Development
Common Name (e.g. server FQDN or YOUR name) []:mycompany.com
Email Address []:me@mycompany.com

Please enter the following &apos;extra&apos; attributes
to be sent with your certificate request
A challenge password []: APassword
An optional company name []: My Company&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Put in answers for country name (AU), Province, City, Organisation,&lt;/li&gt;
&lt;li&gt;FQDN is the Fully Qualified Domain name - you don’t need one of these but if you have a corporate web domain, use that: mycompany.com&lt;/li&gt;
&lt;li&gt;(Optional) It’s recommended that set a password. It can be blank if you are going to protect your certificate in some other way. If you use a password then make sure you store that in a secure place away from your certificates.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;At the end of that, two files are generated:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The certificate signing request: &lt;code class=&quot;language-text&quot;&gt;kafka_test_client.csr&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The certificate’s private key: &lt;code class=&quot;language-text&quot;&gt;kafka_test_client.key&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Keep the .key file secret!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Sign the client certificate&lt;/h3&gt;
&lt;p&gt;We’re now going to take the certificate signing request and ask our AWS Private CA to sign it for us.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;From AWS, get the ARN of your Private CA certificate, e.g. &lt;code class=&quot;language-text&quot;&gt;arn:aws:acm-pca:eu-west-2:123456789:certificate-authority/11111111-1111-1111-1111-111111111111&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Open PowerShell&lt;/li&gt;
&lt;li&gt;Sign the certificate:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;aws acm-pca issue-certificate &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;certificate-authority-arn &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:acm-pca:eu-west-2:123456789:certificate-authority/11111111-1111-1111-1111-111111111111&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;csr fileb:&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;kafka_test_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;csr &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;signing-algorithm &lt;span class=&quot;token string&quot;&gt;&quot;SHA256WITHRSA&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;validity Value=300&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Type&lt;/span&gt;=&lt;span class=&quot;token string&quot;&gt;&quot;DAYS&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;The result will be the ARN of the signed certificate in a JSON snippet:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;CertificateArn&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:acm-pca:eu-west-2:123456789:certificate-authority/11111111-1111-1111-1111-111111111111/certificate/11111111111111111111111&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Note: that’s just the id of the certificate, we haven’t downloaded it yet!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Using the &lt;code class=&quot;language-text&quot;&gt;CertificateArn&lt;/code&gt; in the previous step, download the certificate:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;aws acm-pca &lt;span class=&quot;token function&quot;&gt;get-certificate&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;certificate-authority-arn &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:acm-pca:eu-west-2:123456789:certificate-authority/11111111-1111-1111-1111-111111111111&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;certificate-arn &lt;span class=&quot;token string&quot;&gt;&quot;arn:aws:acm-pca:eu-west-2:123456789:certificate-authority/11111111-1111-1111-1111-111111111111/certificate/11111111111111111111111&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;output text&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;The result looks like (not real certificates, real ones are longer):&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-----BEGIN CERTIFICATE-----
MIIEKjCCAxKgAwIBAgIQaEuWKnMW5/K/++B9NulGxTANBgkqhkiG9w0BAQsFADCB
hTELMAkGA1UEBhMCR0IxHTAbBgNVBAoMFE15IENsaW5pY2FsIE91dGNvbWVzMRQw
HQOr3V2CW1z6Idh6RS4=
-----END CERTIFICATE-----       -----BEGIN CERTIFICATE-----
MIID2DCCAsCgAwIBAgIQQJDUBmoYft8TvHvqvHN65DANBgkqhkiG9w0BAQsFADCB
hTELMAkGA1UEBhMCR0IxHTAbBgNVBAoMFE15IENsaW5pY2FsIE91dGNvbWVzMRQw
EgYDVQQLDAtEZXZlbG9wbWVudDEPMA0GA1UECAwGTG9uZG9uMR8wHQYDVQQDDBZt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Copy the whole result into a new file &lt;code class=&quot;language-text&quot;&gt;kafka_test_client.cer&lt;/code&gt;, this is the client certificate.&lt;/li&gt;
&lt;li&gt;Replace all the characters between &lt;code class=&quot;language-text&quot;&gt;-----END CERTIFICATE-----&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;-----BEGIN CERTIFICATE-----&lt;/code&gt; with a return carriage so that it looks like this:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-----BEGIN CERTIFICATE-----
MIIEKjCCAxKgAwIBAgIQaEuWKnMW5/K/++B9NulGxTANBgkqhkiG9w0BAQsFADCB
hTELMAkGA1UEBhMCR0IxHTAbBgNVBAoMFE15IENsaW5pY2FsIE91dGNvbWVzMRQw
HQOr3V2CW1z6Idh6RS4=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIID2DCCAsCgAwIBAgIQQJDUBmoYft8TvHvqvHN65DANBgkqhkiG9w0BAQsFADCB
hTELMAkGA1UEBhMCR0IxHTAbBgNVBAoMFE15IENsaW5pY2FsIE91dGNvbWVzMRQw
EgYDVQQLDAtEZXZlbG9wbWVudDEPMA0GA1UECAwGTG9uZG9uMR8wHQYDVQQDDBZt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;kafka_test_client.cer&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;kafka_test_client.key&lt;/code&gt; files are used by the .NET client to authenticate. You don’t need the CSR again, if you’re going through a new signing, it’s best to start with a new key altogether.&lt;/p&gt;
&lt;h2&gt;Now Build Your MSK Cluster&lt;/h2&gt;
&lt;p&gt;Out of the scope of this blog, but once you have the Private CA, you can &lt;a href=&quot;https://docs.aws.amazon.com/msk/latest/developerguide/msk-create-cluster.html&quot;&gt;create the MSK Cluster&lt;/a&gt; using Mutual TLS. The client configuration will need the list of brokers, which is called the “bootstrap servers”.&lt;/p&gt;
&lt;h2&gt;.NET Client Config&lt;/h2&gt;
&lt;p&gt;Create a new .NET core command line application to test your code and install the Confluent.Kafka nuget package.&lt;/p&gt;
&lt;p&gt;We’re going to get a list of topics from the Kafka cluster.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Get this from AWS MSK Console, select your cluster, click &quot;View Client Information&quot;, public endpoint&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; bootstrap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;b-1-public.nameofcluster.xxxxx.c2.kafka.eu-west-2.amazonaws.com:9194,b-2-public.nameofcluster.xxxxx.c2.kafka.eu-west-2.amazonaws.com:9194&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// We&apos;re using Admin Client here but this will work for produce and consumer&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    BootstrapServers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bootstrap&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SecurityProtocol &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SecurityProtocol&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ssl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslCertificateLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.cer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    SslKeyLocation &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;kafka_test_client.key&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;adminClientConfig&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Get the cluster&apos;s metadata and print out the topics to the console.&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; metadata &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; adminClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; topic &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Topics&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;$&quot;Topic - &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token expression language-csharp&quot;&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Topic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you are struggling to get connected, add a &lt;code class=&quot;language-text&quot;&gt;Debug&lt;/code&gt;configuration item for more detail.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; adminClientConfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AdminClientConfig&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Debug &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;broker,protocol,metadata,topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Note on CA Location&lt;/h3&gt;
&lt;p&gt;If you are running on Windows, you cannot use the client config &lt;code class=&quot;language-text&quot;&gt;SslCaLocation&lt;/code&gt; to reference a physical CA certificate. The .NET client only appears to obey the Windows Certificate Store. &lt;a href=&quot;https://docs.confluent.io/platform/current/clients/confluent-kafka-dotnet/_site/api/Confluent.Kafka.ClientConfig.html#Confluent_Kafka_ClientConfig_SslCaLocation&quot;&gt;View the docs for more info&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setting IAM Policy that forces MFA use on the command line]]></title><description><![CDATA[Securing your AWS IAM account with MFA is a really good idea. However, if you’re not careful, the AWS IAM policy might stop you from using…]]></description><link>https://brainwipe.github.io/2022-04-06-aws-mfa-on-powershell/</link><guid isPermaLink="false">https://brainwipe.github.io/2022-04-06-aws-mfa-on-powershell/</guid><pubDate>Wed, 06 Apr 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Securing your AWS IAM account with MFA is a really good idea. However, if you’re not careful, the AWS IAM policy might stop you from using the AWS Powershell toolkit. This post is an &lt;a href=&quot;https://en.wikipedia.org/wiki/Aide-m%C3%A9moire&quot;&gt;aide mémoire&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In IAM, you set policies that control access to resources. To force MFA, you might add a policy that looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# Don&apos;t blindly copy this, there&apos;s a problem here
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;BlockAnyAccessOtherThanAboveUnlessSignedInWithMFA&quot;,
            &quot;Effect&quot;: &quot;Deny&quot;,
            &quot;NotAction&quot;: &quot;iam:*&quot;,
            &quot;Resource&quot;: &quot;*&quot;,
            &quot;Condition&quot;: {
                &quot;BoolIfExists&quot;: {
                    &quot;aws:MultiFactorAuthPresent&quot;: &quot;false&quot;
                }
            }
        }
    ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On the surface, this seems sensible. You &lt;strong&gt;Deny&lt;/strong&gt; access to all &lt;code class=&quot;language-text&quot;&gt;Resource&lt;/code&gt; that isn’t &lt;code class=&quot;language-text&quot;&gt;iam&lt;/code&gt; if multi-factor authentication is not present. It’s a mouthful but the logic is sound.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You need access to IAM to login at all, so you can’t deny that&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://aws.amazon.com/premiumsupport/knowledge-center/mfa-iam-user-aws-cli/&quot;&gt;https://aws.amazon.com/premiumsupport/knowledge-center/mfa-iam-user-aws-cli/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[.NET Core Linux Daemon]]></title><description><![CDATA[We’re going to implement a simple Linux daemon service in .NET Core 2.x. The daemon will respond to input arguments and write to the console…]]></description><link>https://brainwipe.github.io/2019-02-05-dotnetcore-linux-daemon/</link><guid isPermaLink="false">https://brainwipe.github.io/2019-02-05-dotnetcore-linux-daemon/</guid><pubDate>Wed, 11 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We’re going to implement a simple Linux daemon service in .NET Core 2.x. The daemon will respond to input arguments and write to the console.&lt;/p&gt;
&lt;h2&gt;Create a .NET Core Linux Daemon&lt;/h2&gt;
&lt;p&gt;We’re going to create a .NET Core 2.x console application that can be run as a service on linux (a daemon). It can also be run via Powershell/Visual Studio for testing.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure you have the &lt;a href=&quot;https://dotnet.microsoft.com/download/dotnet-core/2.2&quot;&gt;.NET Core 2&lt;/a&gt; (or later) SDK installed. I’m using 2.2 for this example.&lt;/li&gt;
&lt;li&gt;Open VS2017, create a new .NET Core Console Project&lt;/li&gt;
&lt;li&gt;Once created, open the project properties, select Build, go to Advanced and select &lt;code class=&quot;language-text&quot;&gt;C# latest minor version&lt;/code&gt;. We need this for the &lt;code class=&quot;language-text&quot;&gt;static async Main&lt;/code&gt; below.&lt;/li&gt;
&lt;li&gt;Using nuget, add the following packages (and their dependencies):
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Configuration.CommandLine&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Configuration.EnvironmentVariables&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.DependencyInjection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Hosting&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Logging.Console&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Options.ConfigurationExtensions&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open Program, remove the Main method and replace it with this Daemon boilerplate:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;HostBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureAppConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddEnvironmentVariables&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddCommandLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddOptions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Configure&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;DaemonConfig&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetSection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Daemon&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;AddSingleton&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IHostedService&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DaemonService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureLogging&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; logging&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                logging&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetSection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Logging&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                logging&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConsole&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RunConsoleAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Don’t worry about the compiler complaining about &lt;code class=&quot;language-text&quot;&gt;DaemonConfig&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;DaemonService&lt;/code&gt;, we’re about to create those. All the other types and methods should be included in using statements.&lt;/p&gt;
&lt;h3&gt;Configuration&lt;/h3&gt;
&lt;p&gt;We want to pass configuration into the daemon as commandline parameters. In the &lt;code class=&quot;language-text&quot;&gt;Main&lt;/code&gt; method, &lt;code class=&quot;language-text&quot;&gt;ConfigureAppConfiguration&lt;/code&gt; binds any commandline arguments to a configuration section called “Daemon”. We need to create a class to hold the command line arguments, we’re going to call it &lt;code class=&quot;language-text&quot;&gt;DaemonConfig&lt;/code&gt;. In the future, if you need to add more command line arguments, then all you need to do is add properties to this class.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DaemonConfig&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;/span&gt; DaemonName &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Service&lt;/h3&gt;
&lt;p&gt;We’re going to add a service so that you can see the daemon running in its simplest form. The service implements &lt;code class=&quot;language-text&quot;&gt;IHostedService&lt;/code&gt; and accepts events from host operating system for Starting, Stopping and so on. The configuration we’ve just created is injected in the constructor for us to use.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DaemonService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;IHostedService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IDisposable&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ILogger&lt;/span&gt; logger&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOptions&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;DaemonConfig&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DaemonService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ILogger&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;DaemonService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; logger&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IOptions&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;DaemonConfig&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; logger&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;StartAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CancellationToken&lt;/span&gt; cancellationToken&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Starting: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CompletedTask&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;StopAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CancellationToken&lt;/span&gt; cancellationToken&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Stopping: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Task&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CompletedTask&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Disposing &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;First Run&lt;/h2&gt;
&lt;p&gt;Build the code you have so far, open powershell and cd into the project folder, run the daemon using:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;dotnet run --Daemon:DaemonName=&quot;Hello World!&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Press CTRL-C to stop the daemon. My console is called &lt;code class=&quot;language-text&quot;&gt;MCO.Reporting.Console&lt;/code&gt;, so I see:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;11:33:54&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console&gt; dotnet run &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;Daemon:DaemonName=&lt;span class=&quot;token string&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt;
Application started&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; Press Ctrl+C to shut down&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
Hosting environment: Production
infoContent root path: C:\projects\MCO-Reporting\src\MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console\bin\Debug\netcoreapp2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;2\
: MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonService&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      Starting: Hello World!
info: MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonService&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      Stopping: Hello World!
info: MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DaemonService&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      Disposing Hello World!
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;11:33:59&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; MCO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Reporting&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Console&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Brighter Servicehost as a .NET Core 2.x linux daemon with RabbitMQ]]></title><description><![CDATA[We’re going to implement a simple linux daemon service in .NET Core 2.x that hosts a Brighter Service for responding to events posted to a…]]></description><link>https://brainwipe.github.io/2019-02-07-brighter-dotnetcorelinuxdaemon/</link><guid isPermaLink="false">https://brainwipe.github.io/2019-02-07-brighter-dotnetcorelinuxdaemon/</guid><pubDate>Wed, 11 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We’re going to implement a simple linux daemon service in .NET Core 2.x that hosts a Brighter Service for responding to events posted to a RabbitMQ queue. If you just want to create a Linux daemon, see my &lt;a href=&quot;/2019-02-05-dotnetcore-linux-daemon&quot;&gt;post on creating a simple dotnet Core linux daemon&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.goparamore.io&quot;&gt;Brighter command processor library&lt;/a&gt; for .NET allows you to decouple the endpoint from the domain. When using the library with a message broker (such as &lt;a href=&quot;https://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt;), you can use a separate service to watch the message queue and respond to their messages. The Brighter &lt;a href=&quot;https://www.goparamore.io/greetings-example/&quot;&gt;Greetings Example&lt;/a&gt; shows you how to host a Brighter Service Activator in a windows server (using a console app and TopShelf).&lt;/p&gt;
&lt;p&gt;We’re not going to cover how to create commands and events and posting them to the queue, you can find details of that in the &lt;a href=&quot;https://github.com/BrighterCommand/Paramore.Brighter.Extensions/blob/master/samples/GreetingsSender/Program.cs&quot;&gt;Sender of the Paramore Extensions Greetings example&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Install RabbitMQ&lt;/h2&gt;
&lt;p&gt;Surf to the &lt;a href=&quot;https://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt; website, download the latest Erlang (programming environment that Rabbit runs on) and installer. Take the default options for each.&lt;/p&gt;
&lt;p&gt;Once installed:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In powershell, enable the management plugin: &lt;code class=&quot;language-text&quot;&gt;rabbitmq-plugins enable rabbitmq_management&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:15672&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Username &lt;code class=&quot;language-text&quot;&gt;guest&lt;/code&gt; and password &lt;code class=&quot;language-text&quot;&gt;guest&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We do not need to create exchanges, queues or bindings in the management UI, Brighter will perform that task for us.&lt;/p&gt;
&lt;h2&gt;Create a .NET Core Linux Daemon&lt;/h2&gt;
&lt;p&gt;We’re going to create a .NET Core 2.x console application that can be run as a service on linux (a daemon). It can also be run via Powershell/Visual Studio for testing.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ensure you have the &lt;a href=&quot;https://dotnet.microsoft.com/download/dotnet-core/2.2&quot;&gt;.NET Core 2.2&lt;/a&gt; (or later) SDK installed.&lt;/li&gt;
&lt;li&gt;Open VS2017, create a new .NET Core Console Project&lt;/li&gt;
&lt;li&gt;Once created, open the project properties, select Build, go to Advanced and select &lt;code class=&quot;language-text&quot;&gt;C# latest minor version&lt;/code&gt;. We need this for the &lt;code class=&quot;language-text&quot;&gt;static async Main&lt;/code&gt; below.&lt;/li&gt;
&lt;li&gt;Using nuget, add the following packages (and their dependencies):
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Configuration.CommandLine&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Configuration.EnvironmentVariables&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.DependencyInjection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Hosting&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Logging.Console&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.Options.ConfigurationExtensions&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Open Program, remove the Main method and replace it with this Daemon boilerplate:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;Task&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;HostBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureAppConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddEnvironmentVariables&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddCommandLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddOptions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureLogging&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; logging&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                logging&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hostingContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetSection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Logging&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                logging&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConsole&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RunConsoleAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is no service or configuration yet, we’re going to let Brighter’s &lt;a href=&quot;https://github.com/BrighterCommand/Paramore.Brighter.Extensions&quot;&gt;extensions&lt;/a&gt; set those up for us.&lt;/p&gt;
&lt;h2&gt;Adding Brighter&lt;/h2&gt;
&lt;p&gt;We’re now going to add Brighter to watch for messages on our Rabbit MQ queue and print them to the console.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Select your project, manage nuget packages and add the following packages (and their dependencies):
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.ServiceActivator&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.ServiceActivator.Extensions.DependencyInjection&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.ServiceActivator.Extensions.Hosting&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.MessagingGateway.RMQ&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.Extensions.DependencyInjection&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Creating the Rabbit Gateway Connection&lt;/h2&gt;
&lt;p&gt;At the top of the &lt;code class=&quot;language-text&quot;&gt;Main&lt;/code&gt; we’re going to create the connection to Rabbit. &lt;code class=&quot;language-text&quot;&gt;Name&lt;/code&gt; allows us to identify what is connected in the management UI, the AMPQ Uri is the connection string with &lt;code class=&quot;language-text&quot;&gt;guest&lt;/code&gt; for username and password (the default). The Exchange is the “port” which acts as an interface between the queues and our consumer console app.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; rmqConnection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;RmqMessagingGatewayConnection&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;My Linux Daemon&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        AmpqUri &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;AmqpUriSpecification&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;Uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;amqp://guest:guest@localhost:5672&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        Exchange &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;Exchange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my.exchange&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fanout&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; rmqMessageConsumerFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;RmqMessageConsumerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rmqConnection&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After that, we need to build a connection for each of the events that we are going to consume. The connection has an optional &lt;code class=&quot;language-text&quot;&gt;ConnectionName&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;ChannelName&lt;/code&gt; will become the name of the queue in RabbitMQ. Durable queues are those that remember your messages (events and commands) even if RabbitMQ (sometimes called The Node) is restarted.l&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; connection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;Connection&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;MyEvent&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;ConnectionName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;MCO.Reporting.Console&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;ChannelName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my.qeue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token named-parameter punctuation&quot;&gt;timeoutInMilliseconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token named-parameter punctuation&quot;&gt;isDurable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token named-parameter punctuation&quot;&gt;highAvailability&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;NB: you can customise Brighter by passing an anonymous type when calling &lt;code class=&quot;language-text&quot;&gt;AddBrighter()&lt;/code&gt; &lt;a href=&quot;https://github.com/BrighterCommand/Paramore.Brighter.Extensions#1-paramorebrighterextensionsdependencyinjection&quot;&gt;see the docs!&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[AWS Elastic Container Registry with docker compose on Powershell]]></title><description><![CDATA[Amazon Web Services (AWS) Elastic Container Registry (ECR) is a store for your docker images. Once you create your images locally, you can…]]></description><link>https://brainwipe.github.io/2018-07-11-aws-ecr-docker-powershell/</link><guid isPermaLink="false">https://brainwipe.github.io/2018-07-11-aws-ecr-docker-powershell/</guid><pubDate>Wed, 11 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Amazon Web Services (AWS) &lt;a href=&quot;https://aws.amazon.com/ecr/&quot;&gt;Elastic Container Registry&lt;/a&gt; (ECR) is a store for your &lt;a href=&quot;https://docs.docker.com/glossary/?term=image&quot;&gt;docker images&lt;/a&gt;. Once you create your images locally, you can push them up to the ECR and in turn make them live. In this article, we’re going to use an AWS IAM account that has Multi Factor Authentication (MFA) switched on to push multiple containers to the registry using docker compose.&lt;/p&gt;
&lt;h2&gt;Revising Terminology&lt;/h2&gt;
&lt;p&gt;A docker &lt;em&gt;container&lt;/em&gt; runs your live application. A docker &lt;em&gt;image&lt;/em&gt; is the template that is used to create the container. It is a collection of files: executables, frameworks and static content. A docker &lt;em&gt;repository&lt;/em&gt; is a set of docker images. You distinguish between different images in the repository using &lt;em&gt;tags&lt;/em&gt;. A &lt;em&gt;registry&lt;/em&gt; is a hosted service that holds repositories and their images. &lt;a href=&quot;https://hub.docker.com/&quot;&gt;Docker Hub&lt;/a&gt; is the default registry, we’re going to use the AWS &lt;a href=&quot;https://aws.amazon.com/ecr/&quot;&gt;Elastic Container Registry&lt;/a&gt;. &lt;em&gt;Docker compose&lt;/em&gt; is a tool for dealing with multiple images at the same time.&lt;/p&gt;
&lt;p&gt;More detail in &lt;a href=&quot;https://docs.docker.com/glossary/&quot;&gt;the offical Glossary&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Pre-requisites&lt;/h2&gt;
&lt;p&gt;You will need the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Up-to-date Powershell&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/powershell/latest/userguide/pstools-getting-set-up-windows.html&quot;&gt;AWS Tools for Powershell&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;docker for Windows! Check out &lt;a href=&quot;https://brainwipe.github.io/2017-10-30-oauth-on-docker-part1&quot;&gt;my guide&lt;/a&gt; for doing that.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable.html&quot;&gt;MFA set up&lt;/a&gt; on you IAM account and a device that can perform 2 factor authentication (I use my phone with &lt;a href=&quot;https://support.google.com/accounts/answer/1066447?co=GENIE.Platform%3DAndroid&amp;#x26;hl=en&quot;&gt;Google Authenticator&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;The serial number of your MFA device. You can find it on the IAM user details and will look something like this: &lt;code class=&quot;language-text&quot;&gt;arn:aws:iam::123123123123:mfa/Rob&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ensure that you have created an AWS IAM user to communicate with AWS. Do not use your root user account. In the account detail for the IAM user, &lt;a href=&quot;https://docs.aws.amazon.com/powershell/latest/userguide/pstools-appendix-sign-up.html&quot;&gt;create an access key and secret pair&lt;/a&gt;. The secret will only be displayed once, so I’d copy it somewhere you know you can destroy it or leave the browser window open.&lt;/p&gt;
&lt;p&gt;You will then need to configure the AWS Powershell tools to use these credentials. Make sure that you’re using a profile that suits your machine, I used:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Set-AWSCredential -AccessKey THISISTHEACCESSKRY -SecretKey IMNOTPUTTINGTHESECRETONTHEINTERNET -StoreAs default&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;My example App&lt;/h2&gt;
&lt;p&gt;For my example, I’m going to be using docker-compose that &lt;a href=&quot;https://brainwipe.github.io/2017-10-30-oauth-on-docker-part1&quot;&gt;I introduced in my OAuth blog post&lt;/a&gt;. The docker-compose file creates two images. It currently looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;dockerdotnetoauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dockerdotnetoauth
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./DockerDotNetOAuth
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile

&lt;span class=&quot;token key atrule&quot;&gt;identityserver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; identityserver
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./IdentityServer
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Create ECR Repositories&lt;/h2&gt;
&lt;p&gt;Log into AWS and go to Elastic Container Service (ECS), you’ll find ECR is listed at the end. Click &lt;strong&gt;Create Repository&lt;/strong&gt; and give it the same name as your images (not required but saves a lot of confusion). For each image, you will get a Repository URI it will look something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;123123123123.dkr.ecr.eu-west-1.amazonaws.com/dockerdotnetoauth&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The format is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;your account number&gt;.dkr.ecr.&amp;lt;region&gt;.amazonaws.com/&amp;lt;name of image&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These are empty repositories, they are just placeholders that you can put your images into.&lt;/p&gt;
&lt;h2&gt;Getting images into the repositories&lt;/h2&gt;
&lt;p&gt;There are two ways to do this: tag your image or update your docker compose. The &lt;a href=&quot;https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html&quot;&gt;official documentation&lt;/a&gt; goes into great length about tagging and pushing an existing image. Instead, we’re going to update the docker compose file so that we can push more than one image at a time.&lt;/p&gt;
&lt;p&gt;Take the repository URI you got in the previous step and use it for the image name.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;dockerdotnetoauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 123123123123.dkr.ecr.eu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;1.amazonaws.com/dockerdotnetoauth
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./DockerDotNetOAuth
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile

&lt;span class=&quot;token key atrule&quot;&gt;identityserver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 123123123123.dkr.ecr.eu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;west&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;1.amazonaws.com/identityserver
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./IdentityServer
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you next build the docker compose (as with Visual Studio 2017) it will create the images with the full name. It is a big, ugly name but there’s currently no way to give it a domain CNAME. If you’re concerned that your AWS account number is going to be stored in source control, then I recommend not checking it in and having it part of your dev environment setup.&lt;/p&gt;
&lt;h2&gt;Log docker into AWS&lt;/h2&gt;
&lt;p&gt;To be able to push your images up to the registry, docker needs access to your AWS account. As we are using Multi Factor Authentication (MFA), you will need to have your device (phone) handy to get the MFA access code.&lt;/p&gt;
&lt;p&gt;The steps the script takes are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open Powershell!&lt;/li&gt;
&lt;li&gt;Log into AWS Secure Token Server to get an access token.&lt;/li&gt;
&lt;li&gt;Get the docker login command from ECR&lt;/li&gt;
&lt;li&gt;Invoke the docker login command&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When requesting a token from AWS, you need to specify how long (in seconds) you want the token to last for. The maximum is 36 hours but it depends on your use case. If you are logging in purely to upload the latest image build then 300 seconds should be enough. If you are dev ops and uploading for a working day, then 28800 seconds (8 hours) is enough.&lt;/p&gt;
&lt;p&gt;To get the token and store it in a Powershell variable use:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$token = Get-STSSessionToken -DurationInSeconds &amp;lt;how long in seconds&gt; -SerialNumber &amp;lt;mfa serial&gt; -TokenCode &amp;lt;code from the authenticator on your phone&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$token = Get-STSSessionToken -DurationInSeconds 28800 -SerialNumber arn:aws:iam::123123123123:mfa/Rob -TokenCode 123123&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’re then going to get the docker login command from ECR and invoke it immediately:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; Invoke-Expression –Command (Get-ECRLoginCommand -Credential $token).Command&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your local docker is now logged into ECR.&lt;/p&gt;
&lt;h2&gt;Push all your images via docker compose&lt;/h2&gt;
&lt;p&gt;The benefit of setting the image name in docker compose to the full ECR URI is that you can then push all of your built containers in one go. That’s useful if you’re using docker compose inside Visual Studio to build .NET Core Linux containers. Visual Studio doesn’t care what the image names are.&lt;/p&gt;
&lt;p&gt;To push all of your built images with the &lt;code class=&quot;language-text&quot;&gt;:latest&lt;/code&gt; tag up to ECR, use:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker-compose push&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your containers are now stored on ECR!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ASP.NET Core 2 API on Docker with OAuth (Part 2)]]></title><description><![CDATA[In Part 1 we built an ASP.NET Core 2 API and got an Identity Server all running on docker containers. In this part we’re going to add a…]]></description><link>https://brainwipe.github.io/2017-10-30-oauth-on-docker-part2/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-10-30-oauth-on-docker-part2/</guid><pubDate>Mon, 30 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In &lt;a href=&quot;/2017-10-30-oauth-on-docker-part1&quot;&gt;Part 1&lt;/a&gt; we built an ASP.NET Core 2 API and got an Identity Server all running on docker containers. In this part we’re going to add a client application that can get a token from the Identity Server, apply authorization to the API service and then use the token to call the service.&lt;/p&gt;
&lt;p&gt;You can grab the completed code from the &lt;a href=&quot;https://github.com/brainwipe/DockerDotNetOAuth&quot;&gt;DockerDotNetOAuth&lt;/a&gt; GitHub repository.&lt;/p&gt;
&lt;h2&gt;Specify Port Binding in Docker Compose&lt;/h2&gt;
&lt;p&gt;Up until now we’ve let docker compose decide what ports we’re going to use. This has been fine so far but we need to fix them so that the client HTML page knows where its resources are. The best solution is to use domains and forwarding but that’s out of the scope of this post.&lt;/p&gt;
&lt;p&gt;Open &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; and update the existing services to include the port numbers:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;dockerdotnetoauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dockerdotnetoauth
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 32771&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./DockerDotNetOAuth
      &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile

  &lt;span class=&quot;token key atrule&quot;&gt;identityserver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; identityserver
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 32772&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./IdentityServer
      &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the same port binding that we saw in the &lt;code class=&quot;language-text&quot;&gt;docker ps&lt;/code&gt; command. Now with subsequent runs of the system, the ports will remain the same.&lt;/p&gt;
&lt;h2&gt;Client Docker Container&lt;/h2&gt;
&lt;p&gt;For our client, we’re going to use an HTML web page running on an nginx docker container. We’ll get the client container running first and then come back for the HTML.&lt;/p&gt;
&lt;p&gt;In your solution folder, create a new folder called Client. You’ll need to do the same in Visual Studio. In the Client folder, add a new file called &lt;code class=&quot;language-text&quot;&gt;Dockerfile&lt;/code&gt; (no extension). The DockerFile is going to describe how to build our client container image. The DockerFile is extremely simple:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;FROM nginx
EXPOSE 32773&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For our system to turn this DockerFile description into a container image, we need to add it to our &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; file. Add the following section into your docker-compose file under your other services. Make sure that the &lt;code class=&quot;language-text&quot;&gt;testclient&lt;/code&gt; is aligned with the pre-existing &lt;code class=&quot;language-text&quot;&gt;identityserver:&lt;/code&gt; line.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;testclient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; testclient
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
      &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./Client
      &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ./Client&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/usr/share/nginx/html
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 32773&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will use the DockerFile found in the &lt;code class=&quot;language-text&quot;&gt;./Client&lt;/code&gt; folder and bind external port &lt;code class=&quot;language-text&quot;&gt;32773&lt;/code&gt; to the nginx default of port &lt;code class=&quot;language-text&quot;&gt;80&lt;/code&gt;. You can run the solution at this point and the container will run but there won’t be any content at &lt;code class=&quot;language-text&quot;&gt;http://localhost:32773/&lt;/code&gt; because we’ve not make the HTML yet, nginx will give a 403 by default.&lt;/p&gt;
&lt;h3&gt;Volumes&lt;/h3&gt;
&lt;p&gt;Different to our other containers is &lt;code class=&quot;language-text&quot;&gt;volumes&lt;/code&gt;, this line maps a folder on our hard-drive with a folder in the running container. We want to do this so that when we update the client HTML file (we’re about to build) then the container updates automatically. This saves us from having to rebuild the container image every time we make an HTML change. This is useful for the client as it’s only a single HTML page that doesn’t have a build process.&lt;/p&gt;
&lt;p&gt;If you are using .NET or webpack or npm or any modern front end tooling you will have a build chain whose output can be put into the container image on each build. The benefit of copying the build output into the container image is that then the resulting container contains &lt;em&gt;everything you need to run the site&lt;/em&gt;. You can deploy that image to test, staging and so on. If you use volumes then you are depending on files outside the container.&lt;/p&gt;
&lt;h2&gt;Create simple HTML client&lt;/h2&gt;
&lt;p&gt;We’re going to use jQuery to get a token from Identity Server. Add a new HTML file called &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;./Client/&lt;/code&gt;. Here’s the source:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token doctype&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;!&lt;/span&gt;&lt;span class=&quot;token doctype-tag&quot;&gt;DOCTYPE&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test Client&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
Test Client
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://code.jquery.com/jquery-3.2.1.min.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;span class=&quot;token language-javascript&quot;&gt;
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        $&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ajax&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;POST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;http://localhost:32772/connect/token&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token literal-property property&quot;&gt;crossDomain&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token literal-property property&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token string-property property&quot;&gt;&quot;client_id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token string-property property&quot;&gt;&quot;grant_type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;client_credentials&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token string-property property&quot;&gt;&quot;client_secret&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;secret&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token string-property property&quot;&gt;&quot;scopes&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;api1&quot;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Got token: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;access_token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;GetToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once the page has loaded then a POST Ajax query is sent to the token creation endpoint of Identity Server with the scope &lt;code class=&quot;language-text&quot;&gt;api1&lt;/code&gt;, secret of &lt;code class=&quot;language-text&quot;&gt;secret&lt;/code&gt;, client name of &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; and a grant type of &lt;code class=&quot;language-text&quot;&gt;client_credentials&lt;/code&gt;, which simply means that a secret is all that’s required. If it is successful then it will print the token to the javascript console.&lt;/p&gt;
&lt;p&gt;In Visual Studio Press &lt;kbd&gt;F5&lt;/kbd&gt; to see it fail!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/24671e2b30e554593b2173c20f1e09f6/65654/aspnet-core2-cors.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 13.924050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAB2HAAAdhwGP5fFlAAAAmUlEQVQI11XLS07EMBAA0dz/kKBRMhknxHbbbbcDCl0jPkJi8ValmlIp1NboZlRVVJXe+5+iimhFvprZj97/+/1LKUzXsuJhw0JA5pn9diOtK8eyEO93PkLAXl55nxf8EfD1ge87HiN+HPjbASKcOVO3jYkseBYuKd9MBE2JGiMtZ1wVpECteMqQM7QGY4AN3AacJ59jcI3BE+Sw5exVbRc0AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;We haven&amp;#39;t set up CORS yet&quot;
        title=&quot;We haven&amp;#39;t set up CORS yet&quot;
        src=&quot;/static/24671e2b30e554593b2173c20f1e09f6/f058b/aspnet-core2-cors.png&quot;
        srcset=&quot;/static/24671e2b30e554593b2173c20f1e09f6/c26ae/aspnet-core2-cors.png 158w,
/static/24671e2b30e554593b2173c20f1e09f6/6bdcf/aspnet-core2-cors.png 315w,
/static/24671e2b30e554593b2173c20f1e09f6/f058b/aspnet-core2-cors.png 630w,
/static/24671e2b30e554593b2173c20f1e09f6/65654/aspnet-core2-cors.png 872w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Setting up CORS on Identity Server&lt;/h2&gt;
&lt;p&gt;The error above is telling us that the server will not accept POST requests from our origin:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Failed to load http://localhost:32772/connect/token: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource. 
Origin &apos;http://localhost:32773&apos; is therefore not allowed access. The response had HTTP status code 400.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As the Identity Server and client are hosted on different ports, they are different origins, so this is a Cross Origin request and the Identity Server needs to have &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS&quot;&gt;Cross Origin Resource Sharing&lt;/a&gt; enabled.&lt;/p&gt;
&lt;p&gt;First we’re going to “turn off” ASP.NET’s CORS system as Identity Server can do it with much more granularity. Open &lt;code class=&quot;language-text&quot;&gt;startup.cs&lt;/code&gt; and add the following line into the &lt;code class=&quot;language-text&quot;&gt;Configure(...)&lt;/code&gt; method.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseCors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;builder &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowAnyOrigin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowAnyHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowAnyMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowCredentials&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next we’re going to tell Identity Server to use an in memory CORS policy. Update your &lt;code class=&quot;language-text&quot;&gt;ConfigureServices(...)&lt;/code&gt; method to:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddIdentityServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInMemoryApiResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetApiResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInMemoryClients&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetClients&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;AddCorsPolicyService&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;InMemoryCorsPolicyService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Add the CORS service&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddDeveloperSigningCredential&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we need to tell Identity Server which origins are allowed. Open &lt;code class=&quot;language-text&quot;&gt;Configuration.cs&lt;/code&gt; and add the following under &lt;code class=&quot;language-text&quot;&gt;AllowedScopes&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;AllowedCorsOrigins &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:32773&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This allows only the test client to request tokens. Run the app &lt;kbd&gt;F5&lt;/kbd&gt;, point your browser at your &lt;a href=&quot;http://localhost:32771&quot;&gt;test client&lt;/a&gt;, open the console and you should see the token that we’re going to pass to the API. It will look something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Got token: eyJhbGciOiJSUzI1NiIsImtpZCI6IjUzZTVjZDE3YWEzYjkxZGUwMmUyZWI5MzdiODdmZTU2IiwidHlwIjoiSldUIn0.eyJuYmYiOjE1MDkzNzQ1MzAsImV4cCI6MTUwOTM3ODEzMCwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDozMjc3MiIsImF1ZCI6WyJodHRwOi8vbG9jYWxob3N0OjMyNzcyL3Jlc291cmNlcyIsImFwaTEiXSwiY2xpZW50X2lkIjoiY2xpZW50Iiwic2NvcGUiOlsiYXBpMSJdfQ.DkS9Wcb3AzvzcCJS1JnBICE9pBuzc4d8j1LzbUcgyjKbha56c3NSNyT6W0yZSm5LA5aaBbMVJMnZYYrfbCGDUkbKbX2NmKfkrB16O0y5BH2z1ruBXjMUG2Iks36VYbsGS8ZBd7InTmPeYk4hdjygDkLyFlH5WI94_KKYIE5wPQNVH2d7iiQgocKI8WlIphCCLjPA5CG-kyTYl8zUtT9lxh1fJcXtjvZKphfpbPijgw5_l0fZWvnlk4GS0Xi9bvsFxwATV3ISw_geUCKSWV5sojFCnIyeCgtlmGXFUvetUvVB1xVpuRN-JU1LVGgT1Fx3kszLdwip_wahu-CnooOcpA&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Setting CORS on the API&lt;/h2&gt;
&lt;p&gt;Before we add authorization onto the API, we must tell the API that the client site is allowed to access it. We do this with CORS but unlike we did in &lt;a href=&quot;/2017-10-30-oauth-on-docker-part1&quot;&gt;Part 1&lt;/a&gt;, we want ASP.NET to control access rather than Identity Server.&lt;/p&gt;
&lt;p&gt;Open &lt;code class=&quot;language-text&quot;&gt;startup.cs&lt;/code&gt;, in &lt;code class=&quot;language-text&quot;&gt;ConfigureServices(...)&lt;/code&gt; add:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddCors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-text&quot;&gt;Configure(...)&lt;/code&gt; add &lt;em&gt;before&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;UseMvc()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseCors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    builder &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; builder
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowAnyHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AllowAnyMethod&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WithOrigins&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:32773&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is saying that it will allow any header value, any method (POST, GET, PUT etc) from the client website. Before production we would limit this to just the methods and headers we want.&lt;/p&gt;
&lt;h2&gt;Setting Issuer Uri on Identity Server&lt;/h2&gt;
&lt;p&gt;When we run Identity Server as a developer on our local boxes, we map the port such that we can simply go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:32772/&lt;/code&gt;. The API needs to be able to contact the Identity Server to get the discovery document and check the client’s token then it needs a URI to call. The default Issuer Uri for the Identity Server is also &lt;code class=&quot;language-text&quot;&gt;http://localhost:32772&lt;/code&gt;. You can double check this on the discovery document at &lt;a href=&quot;localhost:32772/.well-known/openid-configuration&quot;&gt;localhost:32772/.well-known/openid-configuration&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Our system is built within docker containers, so when the API calls &lt;code class=&quot;language-text&quot;&gt;localhost:32772&lt;/code&gt; then it will look at port &lt;code class=&quot;language-text&quot;&gt;32772&lt;/code&gt; of its own container. So the API will need to use &lt;code class=&quot;language-text&quot;&gt;http://identityserver&lt;/code&gt; instead (we’ll set that in the next step). However this will not work straight away because the Issuer Uri in Identity Server and the Authority used by the API need to match. Therefore we need to override the Issuer Uri in Identity Server to &lt;code class=&quot;language-text&quot;&gt;http://identityserver&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Open the Identity Server &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt; and in &lt;code class=&quot;language-text&quot;&gt;ConfigureServices(...)&lt;/code&gt; change the &lt;code class=&quot;language-text&quot;&gt;AddIdentityServer()&lt;/code&gt; line to:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddIdentityServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;opt &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IssuerUri &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://identityserver&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you now call the discovery document on &lt;a href=&quot;localhost:32772/.well-known/openid-configuration&quot;&gt;localhost:32772/.well-known/openid-configuration&lt;/a&gt; then you’ll see the Issuer Uri is &lt;code class=&quot;language-text&quot;&gt;&quot;http://identityserver&quot;&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;This is simple but not ideal&lt;/h3&gt;
&lt;p&gt;This works for our example but the best solution (not covered here) is to assign domains to your containers. If we had an API external to your docker host then it would not be able to validate tokens against &lt;code class=&quot;language-text&quot;&gt;http://identityserver&lt;/code&gt; because that URI is only understood inside your docker host.&lt;/p&gt;
&lt;h2&gt;Securing the API Service&lt;/h2&gt;
&lt;p&gt;In this step we’re going to secure our &lt;code class=&quot;language-text&quot;&gt;api/value&lt;/code&gt; web service so that it requires a bearer token. First we’re going to install the &lt;a href=&quot;https://www.nuget.org/packages/IdentityServer4.AccessTokenValidation/&quot;&gt;IdentityServer4.AccesstokenValidation&lt;/a&gt; nuget package into our API project.&lt;/p&gt;
&lt;p&gt;Open &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt;, in &lt;code class=&quot;language-text&quot;&gt;ConfigureService(...)&lt;/code&gt; add:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddAuthentication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;opt &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DefaultScheme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; IdentityServerAuthenticationDefaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AuthenticationScheme&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DefaultAuthenticateScheme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; IdentityServerAuthenticationDefaults&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AuthenticationScheme&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddIdentityServerAuthentication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        opt &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Authority &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://identityserver&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RequireHttpsMetadata &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            opt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ApiName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;api1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first call to services (&lt;code class=&quot;language-text&quot;&gt;AddAuthentication&lt;/code&gt;) sets the authentication scheme to &lt;code class=&quot;language-text&quot;&gt;bearer&lt;/code&gt; and then the identity server is given as the secure token server. We don’t need the secret at this point because we’re not a client. We will take the token from the client and pass it to the Identity Server to check.&lt;/p&gt;
&lt;p&gt;In the &lt;code class=&quot;language-text&quot;&gt;Configure(...)&lt;/code&gt; method, add authentication to pipeline &lt;em&gt;before&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;UseMvc()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseAuthentication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we need to specify which controllers need authentication. Open &lt;code class=&quot;language-text&quot;&gt;./Controllers/ValuesController.cs&lt;/code&gt; and add the &lt;code class=&quot;language-text&quot;&gt;Authorize&lt;/code&gt; attribute to the controller like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attribute&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Route&lt;/span&gt;&lt;span class=&quot;token attribute-arguments&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;api/[controller]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attribute&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Authorize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ValuesController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Controller&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Snip for brevity&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Test without the token&lt;/h2&gt;
&lt;p&gt;Before we start using the token, press &lt;kbd&gt;F5&lt;/kbd&gt; and the sites will run up. If you go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:32771/api/values&lt;/code&gt; then nothing will appear, in the browser’s console (press F12), the network tab will show &lt;code class=&quot;language-text&quot;&gt;401 Unauthorized&lt;/code&gt;. Identity Server isn’t being called at all, though because there is no token supplied so ASP.NET responds automatically.&lt;/p&gt;
&lt;h2&gt;Calling the Values Service with a token&lt;/h2&gt;
&lt;p&gt;We’re now going to call the &lt;code class=&quot;language-text&quot;&gt;api/values&lt;/code&gt; service from our test client using the token we already have.&lt;/p&gt;
&lt;p&gt;Open &lt;code class=&quot;language-text&quot;&gt;./Client/index.html&lt;/code&gt; and add this function inside the &lt;code class=&quot;language-text&quot;&gt;&amp;lt;script&gt;&lt;/code&gt; tag:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CallService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    $&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ajax&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token literal-property property&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token literal-property property&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;http://localhost:32771/api/values&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token literal-property property&quot;&gt;crossDomain&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token literal-property property&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token function-variable function&quot;&gt;beforeSend&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;xhr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; xhr&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setRequestHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bearer &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function calls the values API, adding in a Bearer token as the authorization header. For simplicity we’re going to call this from the &lt;code class=&quot;language-text&quot;&gt;done&lt;/code&gt; promise of the &lt;code class=&quot;language-text&quot;&gt;GetToken()&lt;/code&gt; call we had before:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Got token: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;access_token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;CallService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;access_token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you reload the test client page &lt;a href=&quot;http://localhost:32773/&quot;&gt;http://localhost:32773/&lt;/a&gt; then the client first authenticates against Identity Server to get a token and that token is used in the &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; header to call the values API. We have a success! I looks like:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d12170c7cb80a3b028c5b7a4bac54197/31198/aspnet-core2-result.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.278481012658226%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAB2HAAAdhwGP5fFlAAAA8ElEQVQY05VQ24qDMBD1//9sYV8Ki4tRc1OEba1NNBqDxVNmlvRh33bgcGbOZG4p7tcfOOcRQsC2bVjXFd57zPPMPukE0px7sE7v/iIdBy6fHyj8dMf1duOilBInl2XhZvu+I8bITI28d5yjOINqpmnCElaIrwuK4B9QSkG2LbTW6LoOfd/DGMM6+aRRLvtSSmZrLXMtBJTWUOIbhZtGCCHQNA2DfKnkO67rmrWyLJmrqmIt6xSP4wgy24rfk2kbS1ONQa81tJQ8fRiG9xZ5a2IC5QjOOT75BNBRw7gGHMeBMyWcmZ9P/Mfov+OeYJsKL8gcwszfHha4AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Chrome console has both the token and the values from the API&quot;
        title=&quot;Chrome console has both the token and the values from the API&quot;
        src=&quot;/static/d12170c7cb80a3b028c5b7a4bac54197/f058b/aspnet-core2-result.png&quot;
        srcset=&quot;/static/d12170c7cb80a3b028c5b7a4bac54197/c26ae/aspnet-core2-result.png 158w,
/static/d12170c7cb80a3b028c5b7a4bac54197/6bdcf/aspnet-core2-result.png 315w,
/static/d12170c7cb80a3b028c5b7a4bac54197/f058b/aspnet-core2-result.png 630w,
/static/d12170c7cb80a3b028c5b7a4bac54197/31198/aspnet-core2-result.png 694w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We have the token printed first and then the result from the API call.&lt;/p&gt;
&lt;h2&gt;Well done for making it this far&lt;/h2&gt;
&lt;p&gt;If you jumped in at this point, check out &lt;a href=&quot;/2017-10-30-oauth-on-docker-part1&quot;&gt;Part 1&lt;/a&gt; and you can grab the code from the &lt;a href=&quot;https://github.com/brainwipe/DockerDotNetOAuth&quot;&gt;DockerDotNetOAuth&lt;/a&gt; GitHub repository.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ASP.NET Core 2 API on Docker with OAuth (Part 1)]]></title><description><![CDATA[I previously explained how to get a ASP.NET Core 1 site running on docker in this post we’re going to do a similar process but use .NET Core…]]></description><link>https://brainwipe.github.io/2017-10-30-oauth-on-docker-part1/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-10-30-oauth-on-docker-part1/</guid><pubDate>Mon, 30 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I previously explained how to get a &lt;a href=&quot;/2017-05-23-docker-linux-dotnet&quot;&gt;ASP.NET Core 1 site running on docker&lt;/a&gt; in this post we’re going to do a similar process but use .NET Core 2 an add OAuth authentication. The first few steps are the same, it starts to change when we create our projects. &lt;a href=&quot;https://oauth.net/&quot;&gt;OAuth&lt;/a&gt; is a protocol for allow secure authorization. We will be using &lt;a href=&quot;https://identityserver.io/&quot;&gt;Identity Server 4&lt;/a&gt; running in its own container to provide us with a token when we give it a username and password.&lt;/p&gt;
&lt;p&gt;In this part we’ll set up the API and Identity Server. In &lt;a href=&quot;/2017-10-30-oauth-on-docker-part2&quot;&gt;Part 2&lt;/a&gt; we will add a client and authorization to this service.&lt;/p&gt;
&lt;p&gt;The finished code (for both parts) is on my &lt;a href=&quot;https://github.com/brainwipe/DockerDotNetOAuth&quot;&gt;DockerDotNetOAuth&lt;/a&gt; GitHub repository.&lt;/p&gt;
&lt;h2&gt;Why run a separate container for Identity Server?&lt;/h2&gt;
&lt;p&gt;You &lt;em&gt;can&lt;/em&gt; run Identity Server in your &lt;a href=&quot;https://identityserver4.readthedocs.io/en/release/quickstarts/0_overview.html&quot;&gt;existing ASP.NET Core MVC project&lt;/a&gt;. However, containerisation gives us the ability to split up our application into separate micro services.&lt;/p&gt;
&lt;p&gt;The benefits of splitting out the Identity Server are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You can deploy authentication separately to your product domain and vice versa&lt;/li&gt;
&lt;li&gt;It’s easier to swap out your authentication framework if you start with it separated&lt;/li&gt;
&lt;li&gt;You can scale out your product domain without duplicating your authentication&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The drawback is that &lt;strong&gt;it’s more complicated&lt;/strong&gt;! Hopefully, once you have it working then you can spend your time on building just your product domain.&lt;/p&gt;
&lt;h2&gt;Install Docker for Windows&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/docker-for-windows/install/#download-docker-for-windows&quot;&gt;Download Docker for Windows&lt;/a&gt;. I recommend the stable channel. I used the defaults for everything, I suggest you do too!&lt;/p&gt;
&lt;p&gt;Once docker for Windows is installed, find the docker whale icon in the status bar right click and choose &lt;code class=&quot;language-text&quot;&gt;Settings...&lt;/code&gt;. On the left of the settings window, choose &lt;code class=&quot;language-text&quot;&gt;Shared Drives&lt;/code&gt; and tick the box for &lt;code class=&quot;language-text&quot;&gt;C:&lt;/code&gt;. This will give the docker machine access to the files on the &lt;code class=&quot;language-text&quot;&gt;C:&lt;/code&gt; drive, which is doesn’t have by default.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACTUlEQVQ4y52STWsTURSGZ+dGwQ/w57hQUBH/hiux6kbUXam6kO5cKFI/skiq1o0bMaZQsBSKttNiVWI/kmYmmUw+J5PJZDKZufPIvWlskYLigYeXOXfOO+ecO5plmnhOCxEGxANfaRJHIGISESuViGiIiKPfmhyAaAAI+tYO2lp+h7XtMvlyg+9GnXKrS7vdplAoYBgGxWIRy6pyWIgkUbr+bZOnr+YJGjW09OIPUot50svbpL8YfNpq0HU7mKZJ1bJoNps4jkOn06HrurRaLTzPU0bJnmFmocKDOQO/aqAZu0VKhqEKZKHv+wwGA1XU7XaJogghBHEcK+SzVJmTJELg+QHdAYT1EppZ2qVareJ5XVzXpd/vE4ZDbLtGEAyIopjhMFJIszAMaTuO0mEk80PiaIjstWcV0WyrQqvdVt3ILmWHsgNZEMeCf4nx6L40rBgl6vWGMpJjjg0Pvvx3xL6hsVvANMtqbMnYcLSjZG9/glgcQjwmRoxHrlbK1Op1bNtWKEOR8D8R2CU0q2zS6bj0ej06rgsi4m12hSt3nzAxOcPN+yluPUxzZ3p2jwy3pzMqNzH1guv3XnJt8hlXp1L8XNfRPEdeiKv+vVazqb50Y+o52pEzaKcvoZ04P+LUxREnJRdGuaNn0Y6dQzsuzy+z8CGHZjsN2p6P4/l0eoHahb5VZ+bdZ1LvdWazOm9yOq8/rv6Bztz8GnM5nceZLI9mc1R2ttC2V7KY+qLC3limlV8lKG8S2QVCqwC1AjQPobFPY2OJ6tcl2qvz/ALIF6cBdQNpfAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Docker Settings window showing the shared drive and the C drive ticked&quot;
        title=&quot;The Docker Settings window showing the shared drive and the C drive ticked&quot;
        src=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png&quot;
        srcset=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/c26ae/docker-settings-share-drive.png 158w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/6bdcf/docker-settings-share-drive.png 315w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png 630w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/40601/docker-settings-share-drive.png 945w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/78612/docker-settings-share-drive.png 1260w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png 1670w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Create the new Project&lt;/h2&gt;
&lt;p&gt;Click &lt;code class=&quot;language-text&quot;&gt;File -&gt; New Project&lt;/code&gt; and under Visual C#/.NET Core choose a new ASP.NET Core Web Application. Give it a meaningful name (better than the one I came up with!) as below.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7292204c37a291e03fb110bdf351c971/40601/aspnet-core2-create.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACL0lEQVQ4y31T2W7bMBDUr0gWdVniIYqURPmIa8uB3aBAf7IPfStaoImdpkmT/5qCtKUaTdqHAYXl7nB2duV9+/wJt1+/4Ol4h8fD7YjnH0cHG395uB+/f90f8PzwgMfjAU/3dy72dDzg5913V+c1SiGdUvh+iMkkgh+EWFyt0ZoZuJAoqEBBOdI0ByEJoihFzipXo3QLLhTSjCLLKBiT8Lq6gTFzSKmgVI0sK7De9FBagzEOzgWiKEYYEhASgRACWlAUBcVud4P9/gZ9f43NZgutGnhKlOi3e9S1AecS+ZRhsVyilKUjE0IgTVNMJuEISq2iKdp2Bq1blKWCEBUYK0+Es/kVhJDIc+YU7vbv0c0WrsCqV6pBUQhQ237BUdede9zmTqd0hK13HtZN5y5tsg22Zg5jLOGfsyxrSFmjLDWaZuZOm2trLuEtTIf1eus8HBJsW77vIwgC+H7gziCYjLAx6+cg4JLYm7cGq9UGbduNF3GcnAfwb8Rx+jZhLSvkBT97cEqIouRiqq9h7+yjl4QDPMm4M5tRDk5Pxo9rEhJ3vkY4Eg6ko0ItFaRZoWyvUJo1uKxBnMIIIYlBojdAYtfFMNkT2VmhEgJhlCCjEm3/Ee36A5R5h6pZQtYL8Kp7EzktwZhAkmQInaeJg2d0hYLalwpstzv0/Q7z+Qpdtzyvi3YrM2BYHVlpN8yqUmCUOm/t9L0sIqfW/jLdrs7/BmPV2L9Fqhaz1TW0Nu7X+w3qbtG6urL7bgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Creating a new ASP.NET Core 2 project&quot;
        title=&quot;Creating a new ASP.NET Core 2 project&quot;
        src=&quot;/static/7292204c37a291e03fb110bdf351c971/f058b/aspnet-core2-create.png&quot;
        srcset=&quot;/static/7292204c37a291e03fb110bdf351c971/c26ae/aspnet-core2-create.png 158w,
/static/7292204c37a291e03fb110bdf351c971/6bdcf/aspnet-core2-create.png 315w,
/static/7292204c37a291e03fb110bdf351c971/f058b/aspnet-core2-create.png 630w,
/static/7292204c37a291e03fb110bdf351c971/40601/aspnet-core2-create.png 945w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;For the project settings, select Web API. If you want to make an MVC website rather than an API, then follow the tutorials on the &lt;a href=&quot;http://docs.identityserver.io/en/release/quickstarts/0_overview.html&quot;&gt;Identity Server website&lt;/a&gt;. At the top, select ASP.NET Core 2.0 in the framework drop down (it’s the default). Check the ‘Docker Support’ checkbox, select Linux as the OS, leave authentication unchecked (we’ll do that manually), click OK.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/01c608e8cc1aeef913c9b46886db7918/2e237/aspnet-core2-docker-linux.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACMUlEQVQ4y42SS27bMBCGfZBeqfuepkco0F2XWXXROzSrNo3iBgXSPAzbessW9SAlShZlJ46/QowVJFl1gA8iCfGf+YczSZczVoGHXIUUsYcIXUTkE7tz0iigqyV9W9M3FdumYtfWr9loei3Z9obi6ieTOPCIkgQ/Vfz1BHdujOd5pEKwFjlRVlHmikY31FpTSkVRSsvTuiTLMqTekN9dMilEyjry+fyj58OXGd+uHwnmN2x399ze3LJ9eEBPr3hoNmyMYeo4OOe/uHAczs7OcBzHns2WHuJmyqStK2DLx9MD7z7ByeWOVqY0bUcYhhhjMF3Hfr+nM4aZG+IGMaskIY5jy7CuN4bs9jcT0zYMcfIH3n+F797B7k2/tT9vNh1jDIKirJCVpmkGGouua3TXPwlWlWTdGg77e9JCA48ceB2HwzGJMfbyIKa1pqoqlFJUSqLHCrtasdvd0/c9QmTW2ijyElth1xFF0TNSStq2paoUujsK7rqW/42uM7iua5nP5ywXS9sWJeXR8pSJylK0bqyFYSyaprVZR5qB41ld1wgh7JgM3+HRBsGyKKjaDnF9wSSNA3w/wHOXhEFAWeS2L2VZWitDn14yJB4ZH6W2lsdHyQVBEDBbeHhxxiJcs1qntoJSDiK1rWzkbQKLUsexGSzngjhJ8PwAP0rww4QwikiSFZFQZKV6Fnop/PJscNKYLflQocrTY580jdbPI2F5c/GtkFQVMy9m4cfcLZYsz0/5B94QzfwuCS6hAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Select Web API and check the Docker Tick box&quot;
        title=&quot;Select Web API and check the Docker Tick box&quot;
        src=&quot;/static/01c608e8cc1aeef913c9b46886db7918/f058b/aspnet-core2-docker-linux.png&quot;
        srcset=&quot;/static/01c608e8cc1aeef913c9b46886db7918/c26ae/aspnet-core2-docker-linux.png 158w,
/static/01c608e8cc1aeef913c9b46886db7918/6bdcf/aspnet-core2-docker-linux.png 315w,
/static/01c608e8cc1aeef913c9b46886db7918/f058b/aspnet-core2-docker-linux.png 630w,
/static/01c608e8cc1aeef913c9b46886db7918/2e237/aspnet-core2-docker-linux.png 790w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Make sure you have Docker for Windows running and the docker-compose project is selected as the Start Up project and hit F5 to run the project. The Web API project comes with a default service endpoint that delivers a bit of JSON.&lt;/p&gt;
&lt;h1&gt;The Initial Docker Compose File&lt;/h1&gt;
&lt;p&gt;The docker-compose file is a &lt;code class=&quot;language-text&quot;&gt;yml&lt;/code&gt; file that describes what containers are going to be built and run when you press F5. So far we have a single container which will be called &lt;code class=&quot;language-text&quot;&gt;dockerdotnetoauth&lt;/code&gt;, and has a Docker File in the project directory. You’ll also notice that docker-compose has a child file &lt;code class=&quot;language-text&quot;&gt;docker-compose.override.yml&lt;/code&gt; that has bindings that visual studio needs.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;dockerdotnetoauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dockerdotnetoauth
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./DockerDotNetOAuth
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Create Identity Server Project&lt;/h2&gt;
&lt;p&gt;A Secure Token Server (STS) uses the OAuth authentication mechanism. The STS gives a token to a client that the client passes to the API. The API then calls Identity Server to check that the token is valid.&lt;/p&gt;
&lt;p&gt;Identity Server is an STS implementation in .NET Core that plugs into the ASP.NET Core pipeline, so it needs a website to host it. We’re going to run that new website in a ASP.NET Core Linux docker container too.&lt;/p&gt;
&lt;p&gt;In the Solution Explorer, Right click the Solution, Add -&gt; New Project. Create a new ASP.NET Core Web Application called IdentityServer. Create it as an Empty ASP.NET Core 2.0 project with Linux Docker support and no authentication.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8072c9c04da81d8037364ecd124d2349/2e237/aspnet-core2-idsvr-create.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACOUlEQVQ4y42SzW7TQBSF8x68E8/AjrfgDeAh2CF23bDrDgm1RSmlSdw28f/vxPF4bI/txEk/ZOeHtGLBkY5GMxqde869dyRMA+GapIFDaJuE9oLIMQmsBY3KaFVGU0qaQtIWknWZs67UiZtKDf/WTc3y7juje8PkxvAIhEQIgev5LEyTMI6J/IDc9VCxQBUlMlcs0xViuSROBIk4MEkQUpFMfzL6cBHz7rPPxW+N/XDHptsymUzouo7ZdMqm61DXd3RFhW4aft2OuR2PeXx8xDAMHgwDYzbDcn3iyRWj918Vbz7Bt4cOthrdtMRRTFVVOI6DrmtqrdluO+q6Ye4lBMmKsihQSu2Z5xR1SzK9YfTxsuDtFxhHDNjunoezbVs8z6OqNEfUdc0qy5AyR0r5l1mGquq9oFYr8rah22xYhDm73Y7XeH5+PgnmUp6cvRDUB8Eqz2jaDU3TIJKE7XZ7EjlnD601QRAQhRFhGJJlGWVZIuWZ4FqX/C+0rrEsC8d2ME2T+XyO67pkqxVKNyTTa0ZZEqHUvsG5UhRFOVQ9suh5eMvznDiOB0ZRNAyt73O6XCJLTXx/xSjybCzLxlzMcWybdCmGKGmaDlFeNP+sfz33xQryIXKzjyxFjG3bGE8mppfw5IQEYTS4SFdymGjv7MjXBY5DyYcp95FFjOf7mJY9LKfl+Diui+8HuHFGkmYnoXPh87c+Sb+HoneYiehgXVEMPVQvFvZfYsf7KpMYpseT5TF7mjP/cckflc/P8VJpBxkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Create an empty ASP.NET Core 2 Web API project with Linux Docker support&quot;
        title=&quot;Create an empty ASP.NET Core 2 Web API project with Linux Docker support&quot;
        src=&quot;/static/8072c9c04da81d8037364ecd124d2349/f058b/aspnet-core2-idsvr-create.png&quot;
        srcset=&quot;/static/8072c9c04da81d8037364ecd124d2349/c26ae/aspnet-core2-idsvr-create.png 158w,
/static/8072c9c04da81d8037364ecd124d2349/6bdcf/aspnet-core2-idsvr-create.png 315w,
/static/8072c9c04da81d8037364ecd124d2349/f058b/aspnet-core2-idsvr-create.png 630w,
/static/8072c9c04da81d8037364ecd124d2349/2e237/aspnet-core2-idsvr-create.png 790w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once the project has been built, you’ll notice that a new entry has been added to the docker-compose file, which now looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3&apos;&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;dockerdotnetoauth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; dockerdotnetoauth
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./DockerDotNetOAuth
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile

&lt;span class=&quot;token key atrule&quot;&gt;identityserver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; identityserver
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./IdentityServer
        &lt;span class=&quot;token key atrule&quot;&gt;dockerfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Dockerfile&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This means that two separate containers will be built and run when you run the solution. If you press F5 right now then you’ll still see the original API service because that’s the default page. To see what’s running in docker open a PowerShell window and write &lt;code class=&quot;language-text&quot;&gt;docker ps&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;C:\&gt; docker &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt;
CONTAINER ID        IMAGE                   COMMAND               CREATED              STATUS              PORTS                   NAMES
04e906a3617b        dockerdotnetoauth:dev   &lt;span class=&quot;token string&quot;&gt;&quot;tail -f /dev/null&quot;&lt;/span&gt;   About a minute ago   Up About a minute   0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0:32771-&gt;80/tcp   dockercompose3858451035021284432_dockerdotnetoauth_1
639c48d06f11        identityserver:dev      &lt;span class=&quot;token string&quot;&gt;&quot;tail -f /dev/null&quot;&lt;/span&gt;   About a minute ago   Up About a minute   0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;0:32772-&gt;80/tcp   dockercompose3858451035021284432_identityserver_1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Scroll to the right and you’ll see the Ports column that shows the mapping from localhost to the internal container port. You can see that the API container is on port &lt;code class=&quot;language-text&quot;&gt;32771&lt;/code&gt; and the empty identity server is on port &lt;code class=&quot;language-text&quot;&gt;32772&lt;/code&gt;. These ports might be different for you. To see the identity server, open a browser to &lt;code class=&quot;language-text&quot;&gt;http://localhost:32772&lt;/code&gt;. You’ll get a simple “Hello World!” for output.&lt;/p&gt;
&lt;h2&gt;Identity Server Install&lt;/h2&gt;
&lt;p&gt;We’re going to get Identity Server working first and then move onto authentication and authorization in &lt;a href=&quot;/2017-10-30-oauth-on-docker-part2&quot;&gt;Part 2&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;On your Identity Server project, install the &lt;code class=&quot;language-text&quot;&gt;nuget&lt;/code&gt; package &lt;a href=&quot;https://www.nuget.org/packages/IdentityServer4/&quot;&gt;IdentityServer4.AspNetCore&lt;/a&gt; by Brock Allen and Dominick Baier. Open the Identity Server &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt;. Remove the fluff (including Hello World) and add Identity Server to both the services and the application like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Startup&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IServiceCollection&lt;/span&gt; services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddIdentityServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddDeveloperSigningCredential&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IApplicationBuilder&lt;/span&gt; app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IHostingEnvironment&lt;/span&gt; env&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsDevelopment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseDeveloperExceptionPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseIdentityServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Adding Identity Server Configuration&lt;/h2&gt;
&lt;p&gt;We need to tell Identity Server what API resources (called &lt;strong&gt;scopes&lt;/strong&gt;)  we’re going to protect and who the &lt;strong&gt;clients&lt;/strong&gt; are that are going to call them. For simplicity, we’re going to configure this in memory by hard coding a class called Configuration. In your Identity Server project, create a new class on the root called &lt;code class=&quot;language-text&quot;&gt;Configuration.cs&lt;/code&gt;. We’re going to follow the &lt;a href=&quot;http://docs.identityserver.io/en/release/quickstarts/1_client_credentials.html&quot;&gt;Identity Server 4 guide&lt;/a&gt; to create this class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Configuration&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;IEnumerable&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ApiResource&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetApiResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;List&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ApiResource&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;ApiResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;api1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;My API&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;IEnumerable&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Client&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetClients&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;List&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Client&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;Client&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                ClientId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;client&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

                &lt;span class=&quot;token comment&quot;&gt;// no interactive user, use the clientid/secret for authentication&lt;/span&gt;
                AllowedGrantTypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; GrantTypes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClientCredentials&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

                &lt;span class=&quot;token comment&quot;&gt;// secret for authentication&lt;/span&gt;
                ClientSecrets &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;Secret&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;secret&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sha256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

                &lt;span class=&quot;token comment&quot;&gt;// scopes that client has access to&lt;/span&gt;
                AllowedScopes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;api1&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The configuration says that it will protect an API resource called “My API” with key &lt;code class=&quot;language-text&quot;&gt;api1&lt;/code&gt; and we have a single &lt;code class=&quot;language-text&quot;&gt;Client&lt;/code&gt; that is allowed to access the API if it has a secret, which is simply the hash of the string “secret”.&lt;/p&gt;
&lt;p&gt;Now return the &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt; file and add this configuration to Identity Server:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cs&quot;&gt;&lt;pre class=&quot;language-cs&quot;&gt;&lt;code class=&quot;language-cs&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Startup&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IServiceCollection&lt;/span&gt; services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddIdentityServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddDeveloperSigningCredential&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInMemoryApiResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetApiResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInMemoryClients&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetClients&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// snipped the rest for brevity&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Test Identity Server using its Discover Document&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://tools.ietf.org/html/draft-ietf-oauth-discovery-06&quot;&gt;OAuth 2 specification&lt;/a&gt; defines a discovery document, also known as the “well known” document which is a JSON file that explains how the secure token server can be used. When an API wants validate a token, it will look for the discovery document first.&lt;/p&gt;
&lt;p&gt;Now that you’ve specified scopes and clients, you can now see the well known on you docker container Identity Server: &lt;code class=&quot;language-text&quot;&gt;http://localhost:32772/.well-known/openid-configuration&lt;/code&gt;. Here’s what it looks like in a browser:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e00d104a52bd5136609306cdefcd5fc3/c3fd4/aspnet-core2-wellknown.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAB2HAAAdhwGP5fFlAAACOklEQVQ4y52UWW/TQBRG8///A0/QF96Q0rQCgcQbRUKlojTQdPF4abyO420WLzkoDpSoLVXplT6NJV+f+e6945mEvseNuObySiC8G7wgJJUlclWPylY1VVnT6ZpW/VWnG6o8wzYlti4xqiE5mjGR+YokSXj/s2F6ZpidaWZzw+EPy8HcsH9mOQksfddibIu1LcZYtDZoYynLCs/zkGXN8tMBE20MeZ6jTMWqycmrjLzOqHVF11na1mBbg7YKZRq01fR9P0pKOcoVgiTLWbx7zURpjet5hOGSZRwSy4ioiFjmy1E3v9e0TMkqibKKYT3wUJxOX20caoIgIPAD4jhGlhlxkYyQcBWOa1TEI0y3+vbj9Xq9o+0G3/f3Ng4VQjj4vo/ruKQyJSpCvMwnkD5O4uBnPiJ1EYnAtPYB4HoXqFksFjjONZcXl/i+R7AMcIOQbFVQNjWN2aihNjX9MNwCd8G3wEYphCPwPBchxOh0uQyJQklTd/Td/V79ATwI7LqeMI1IZELVbB0MozaTHBjulLbr7J/Aoi4oVYkyiqEfHnX00Ltb4Gxvew6FL3D8axzfGYdyt+mPQXdzvk1fMtk8yEbiZR5JlWA6cy/xsdjNEx/fMGm7jqIqqeoSayzW2rGHT4XunsP481smmyFEMhqhG6BS6tnA8OhwW3JcRPipO/6r26yB9fA/6rfAzeUw9tBU+GVEpms6nh/xlw9MiqtTsvNj5OIr2cUJ6fkxtZij3B80T9YcFVzgTl/wC2/5GWxXelXgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Identity Server Discovery Document&quot;
        title=&quot;The Identity Server Discovery Document&quot;
        src=&quot;/static/e00d104a52bd5136609306cdefcd5fc3/f058b/aspnet-core2-wellknown.png&quot;
        srcset=&quot;/static/e00d104a52bd5136609306cdefcd5fc3/c26ae/aspnet-core2-wellknown.png 158w,
/static/e00d104a52bd5136609306cdefcd5fc3/6bdcf/aspnet-core2-wellknown.png 315w,
/static/e00d104a52bd5136609306cdefcd5fc3/f058b/aspnet-core2-wellknown.png 630w,
/static/e00d104a52bd5136609306cdefcd5fc3/c3fd4/aspnet-core2-wellknown.png 854w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;End of Part 1&lt;/h2&gt;
&lt;p&gt;We have created an ASP.NET Core 2 Web API running in a Linux docker container, then added Identity Server into its own container and configured it. In &lt;a href=&quot;/2017-10-30-oauth-on-docker-part2&quot;&gt;Part 2&lt;/a&gt; we will create a client container and apply authorization to the Web API so that you’ll need the secret to access it.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using Dependency Injection on the .NET Core Command Line]]></title><description><![CDATA[Developers should build tools to help them develop code. If you are building an ASP.NET web app then I can recommend building a companion…]]></description><link>https://brainwipe.github.io/2017-10-10-di-on-dotnet-core-cli/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-10-10-di-on-dotnet-core-cli/</guid><pubDate>Tue, 10 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Developers should build tools to help them develop code. If you are building an ASP.NET web app then I can recommend building a companion command line tool for you to use. The command line tool is there to help you understand system state or show data in your system in such a way that makes sense for you. It’s not for release, it’s to make you more effective. It’s the one thing I wish I’ve always done.&lt;/p&gt;
&lt;p&gt;I like to include it in the same solution as the main application so that it can be built and kept up to date with the system. I also use it to call the service layer directly (by-passing the web API) and use the real entity objects. I want to be able to use the same dependency injection registration process in the command line&lt;/p&gt;
&lt;p&gt;I’m going to assume you know what dependency injection is. If not, then please do read a bit of &lt;a href=&quot;https://martinfowler.com/articles/injection.html&quot;&gt;Martin Fowler&lt;/a&gt; (I’m a bit of a fan).&lt;/p&gt;
&lt;h2&gt;Get the code&lt;/h2&gt;
&lt;p&gt;For those wanting to jump in, check out the &lt;a href=&quot;https://github.com/brainwipe/DIOnDotNetCoreCLI&quot;&gt;GitHub Repo DIOnDotNetCoreCLI&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;.NET CommandLineUtils&lt;/h2&gt;
&lt;p&gt;.NET Core gives us a new challenge as we can create command line apps that run on both Linux and Windows, making them better for fitting into your tool chains. Microsoft originally created the &lt;code class=&quot;language-text&quot;&gt;CommandLineUtils&lt;/code&gt; DLL but have discontinued support. Instead Nate McMaster (of the ASP.NET team) &lt;a href=&quot;https://github.com/aspnet/Common/pull/261&quot;&gt;has forked the code&lt;/a&gt; and will maintain it as a &lt;a href=&quot;https://github.com/natemcmaster/CommandLineUtils&quot;&gt;personal project&lt;/a&gt;. Thank you to Nate for taking on this ace library!&lt;/p&gt;
&lt;h2&gt;Anonymous functions vs Separate Command Classes&lt;/h2&gt;
&lt;p&gt;If you command line application is simple then I recommend using the &lt;a href=&quot;https://github.com/natemcmaster/CommandLineUtils#usage&quot;&gt;anonymous function method&lt;/a&gt; of building your tools.&lt;/p&gt;
&lt;p&gt;I prefer to split out each command into separate classes. Mostly because I tend to have lots of commands in a single console project. For example &lt;code class=&quot;language-text&quot;&gt;c:/&gt;myapp -say &quot;hello world&quot;&lt;/code&gt; on the commandline would be in a class &lt;code class=&quot;language-text&quot;&gt;SayCommand&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I’m going to assume that you’re following separate command classes for this tutorial.&lt;/p&gt;
&lt;h2&gt;1. Example Console App&lt;/h2&gt;
&lt;p&gt;For this example, we have a service that prints out a Shakespear Quote (&lt;code class=&quot;language-text&quot;&gt;QuotesService&lt;/code&gt;) and a service that wraps text with some ascii art (&lt;code class=&quot;language-text&quot;&gt;FormatterService&lt;/code&gt;). I want to use a command line application to call an exteronal service library. For most of my commands I want them to be of the form: &lt;code class=&quot;language-text&quot;&gt;c:/&gt;myapp &amp;lt;command name&gt; &amp;lt;options&gt;&lt;/code&gt;. The CommandLineUtils library supports multiple levels but&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a new .NET Core Console app: New Project → Visual C#/.NET Core/Console App (.NET COre)&lt;/li&gt;
&lt;li&gt;Right click project → Manage nuget packages&lt;/li&gt;
&lt;li&gt;Click Browse, install &lt;code class=&quot;language-text&quot;&gt;McMaster.Extensions.CommandLineUtils&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Also install &lt;code class=&quot;language-text&quot;&gt;Microsoft.Extensions.DependencyInjection&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2. Add your services&lt;/h2&gt;
&lt;p&gt;When you’re doing this for your application then you add in a reference for your service library. I’m not going to go through how to make one here, you can &lt;a href=&quot;https://github.com/brainwipe/DIOnDotNetCoreCLI/tree/master/DIOnDotNetCoreCLI.Services&quot;&gt;check out the code on Github&lt;/a&gt;. It’s the next bit we want to spend time on.&lt;/p&gt;
&lt;h2&gt;3. Create a root Command Line Application&lt;/h2&gt;
&lt;p&gt;The core class of the CommandLineUtils library is the &lt;code class=&quot;language-text&quot;&gt;CommandLineApplication&lt;/code&gt;. You need to create at least one &lt;code class=&quot;language-text&quot;&gt;CommandLineApplication&lt;/code&gt; and then attach commands to it as children. We’re going to create our own version that can handle the dependency injection.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create a new class &lt;code class=&quot;language-text&quot;&gt;CommandLineApplicationWithDI&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CommandLineApplicationWithDI&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;CommandLineApplication&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IServiceProvider&lt;/span&gt; serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CommandLineApplicationWithDI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IServiceProvider&lt;/span&gt; serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;serviceProvider &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;RegisterCommands&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RegisterCommands&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; command &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;GetServices&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ICommand&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; commandLineApp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; command &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CommandLineApplication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;commandLineApp &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;InvalidCastException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Commands must inherit from ICommand and CommandLineApplication&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            Commands&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;commandLineApp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The constructor takes in the &lt;code class=&quot;language-text&quot;&gt;ServiceProvider&lt;/code&gt;, which is Microsoft’s Dependency Injection container. We’ll come onto that later. It then uses this to find all the classes that implement &lt;code class=&quot;language-text&quot;&gt;ICommand&lt;/code&gt;, which is an interface we need to register our commands to. I’d prefer to do something like &lt;code class=&quot;language-text&quot;&gt;serviceProvider.GetServices&amp;lt;CommandLineApplication&gt;&lt;/code&gt; but we can’t register types under a concrete class and there is no interface provided in &lt;code class=&quot;language-text&quot;&gt;CommandLineUtils&lt;/code&gt; to use. We need to make our own:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ICommand&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s it, only for dependency injection purporses.&lt;/p&gt;
&lt;h2&gt;4. Create a Command&lt;/h2&gt;
&lt;p&gt;Our &lt;code class=&quot;language-text&quot;&gt;QuoteCommand&lt;/code&gt; class will encapuslate everything about our command and make use of the services that will be injected automatically. It must inherit from &lt;code class=&quot;language-text&quot;&gt;CommandLineApplication&lt;/code&gt; to make use of the CommandLineUtils functionality and it needs our &lt;code class=&quot;language-text&quot;&gt;ICommand&lt;/code&gt; interface so that it can be dependency injected.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;internal&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;QuoteCommand&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;CommandLineApplication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ICommand&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IQuotesService&lt;/span&gt; quotesService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;QuoteCommand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IQuotesService&lt;/span&gt; quotesService&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quotesService &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; quotesService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;quote&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Description &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gives you a bit of Shakespear&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;HelpOption&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-? | -h | --help&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;OnExecute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Func&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;Execute&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;quotesService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Shakespear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5. Finally - Create the DI container and Command Line App&lt;/h2&gt;
&lt;p&gt;In Program.cs, remove the Hello World line and then create the dependency injection container:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; serviceProvider &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;ServiceCollection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddMyServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method&quot;&gt;&lt;span class=&quot;token function&quot;&gt;AddSingleton&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ICommand&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; QuoteCommand&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;BuildServiceProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AddMyServices&lt;/code&gt; is a &lt;a href=&quot;DIOnDotNetCoreCLI/DIOnDotNetCoreCLI.Services/ServiceCollectionExtensions.cs&quot;&gt;ServiceCollection Extension&lt;/a&gt; inside my service library. It is responsible for adding its own services to the collection. We then add the &lt;code class=&quot;language-text&quot;&gt;QuoteCommand&lt;/code&gt; on as a Singleton (one per lifetime of the console application) and build it.&lt;/p&gt;
&lt;p&gt;We then pass it into our &lt;code class=&quot;language-text&quot;&gt;CommandLineApplicationWithDI&lt;/code&gt; like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; commandLineApp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;CommandLineApplicationWithDI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And execute the command with the arguments that come in on the command line.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;commandLineApp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Other DI Containers&lt;/h2&gt;
&lt;p&gt;Microsoft’s DI container is really just a set of interfaces and has implementations for other DI containers such as &lt;a href=&quot;https://github.com/structuremap/StructureMap.Microsoft.DependencyInjection&quot;&gt;StructureMap&lt;/a&gt;. With StructureMap, you can add types by convention, so it can automatically find the implementations of &lt;code class=&quot;language-text&quot;&gt;ICommand&lt;/code&gt; for you.&lt;/p&gt;
&lt;h2&gt;Further Reading&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://andrewlock.net/using-dependency-injection-in-a-net-core-console-application/&quot;&gt;Andrew Lock - Using dependency injection in a .Net Core console application&lt;/a&gt;. Has a handy section on logging.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.devbot.net/console-services/&quot;&gt;Tommy Long&lt;/a&gt;. Implements DI at the options level.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Using Brighter on ASP.NET Core 2.0 API]]></title><description><![CDATA[In this post you will learn how to get a simple ASP.NET Core 2 API running that uses the Brighter command pattern for sending updates to an…]]></description><link>https://brainwipe.github.io/2017-10-04-brighter-on-aspnetcore/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-10-04-brighter-on-aspnetcore/</guid><pubDate>Wed, 04 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post you will learn how to get a simple ASP.NET Core 2 API running that uses the &lt;a href=&quot;https://github.com/BrighterCommand/Brighter&quot;&gt;Brighter&lt;/a&gt; command pattern for sending updates to an in-memory database. Brighter is a library that sits between the API layer and your business logic (and persistance/database layer). This is not production code but the smallest number of steps to get a simple Brighter Command Processor working in ASP.NET Core 2.&lt;/p&gt;
&lt;p&gt;You can get the completed code from my example &lt;a href=&quot;https://github.com/brainwipe/BrighterOnAspNetCoreExample&quot;&gt;BrighterOnAspNetCoreExample&lt;/a&gt; repository.&lt;/p&gt;
&lt;h2&gt;Pre-requisites&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Visual Studio 2017&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Command, Query Responsibility Separation&lt;/h2&gt;
&lt;p&gt;CQRS is an architecture pattern where you use a different model to update than you do to query. &lt;a href=&quot;https://martinfowler.com/bliki/CQRS.html&quot;&gt;Martin Fowler&lt;/a&gt; does an excellent job of explaining it in detail. Brigher only deals with the Command side, that is the create, update and delete.&lt;/p&gt;
&lt;h2&gt;1. Create ASP.NET Core 2.0 API Project&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;In Visual Studio, File → New Project → ASP.NET Core&lt;/li&gt;
&lt;li&gt;In the next window choose Web API&lt;/li&gt;
&lt;li&gt;I’m going to call the project BrighterOnAspNetCore&lt;/li&gt;
&lt;li&gt;In the Solution Explorer, right click BrighterOnAspNetCore → Properties&lt;/li&gt;
&lt;li&gt;In Application Tab, select Target Framework as .NET Core 2.0 and save.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2. Update existing dependencies&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Right click on the BrighterOnAspNetCore → Manage Nuget Packages&lt;/li&gt;
&lt;li&gt;Update any existing packages to v2.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3. Add Brighter AspNet Core dependency&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Still in the Nuget Package Manager window, click “Include Prerelease”&lt;/li&gt;
&lt;li&gt;Install &lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter.AspNetCore&lt;/code&gt; by Daniel Stockhammer. (Brighter will be installed too)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;4. Create a library to hold your domain&lt;/h2&gt;
&lt;p&gt;This step is not absolutely necessary but will give a better feel of what a solution ready for production would look like.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In Solution Explorer, right click the Solution → Add&lt;/li&gt;
&lt;li&gt;Choose an ASP.NET Core class library, call it Domain.&lt;/li&gt;
&lt;li&gt;Delete the &lt;code class=&quot;language-text&quot;&gt;Class1.cs&lt;/code&gt; that is created for free.&lt;/li&gt;
&lt;li&gt;Add the &lt;code class=&quot;language-text&quot;&gt;Paramore.Brighter&lt;/code&gt; nuget package to the Domain project.&lt;/li&gt;
&lt;li&gt;Add a project reference to the Domain project from the BrighterOnAspNetCore project.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;5. Add Command and Handler to your domain&lt;/h2&gt;
&lt;p&gt;A Command is a class that holds all the information needed to make a change to your data model. A Handler performs the actual change to the data model. In this case we’re going to create a Command that creates a &lt;code class=&quot;language-text&quot;&gt;Value&lt;/code&gt;, which is simply an integer that you might put into a database.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In your Domain project, add two folders one called &lt;code class=&quot;language-text&quot;&gt;Commands&lt;/code&gt; and one called &lt;code class=&quot;language-text&quot;&gt;Handlers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;In &lt;code class=&quot;language-text&quot;&gt;Domain/Commands&lt;/code&gt; add a new class &lt;code class=&quot;language-text&quot;&gt;CreateValueCommand&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;It must implement the &lt;code class=&quot;language-text&quot;&gt;IRequest&lt;/code&gt; interface, which is simply an Id for an instance of the command.&lt;/li&gt;
&lt;li&gt;Add an &lt;code class=&quot;language-text&quot;&gt;Email&lt;/code&gt; string property and set it in the constructor.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;Paramore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Brighter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commands&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CreateValueCommand&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;IRequest&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CreateValueCommand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            Id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Guid&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewGuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            Value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;/span&gt; Value &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;Guid&lt;/span&gt; Id &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;In &lt;code class=&quot;language-text&quot;&gt;Domain/Handers&lt;/code&gt; add a new class &lt;code class=&quot;language-text&quot;&gt;CreateValueCommandHandler&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;CreateValueCommandHandler&lt;/code&gt; must extend the base class &lt;code class=&quot;language-text&quot;&gt;RequestHandler&amp;lt;CreateValueCommand&gt;&lt;/code&gt;. The generic parameter of &lt;code class=&quot;language-text&quot;&gt;CreateValueCommand&lt;/code&gt; is how we say that this handler is for the &lt;code class=&quot;language-text&quot;&gt;CreateValueCommand&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We override the &lt;code class=&quot;language-text&quot;&gt;Handle()&lt;/code&gt; method, which is where we would put our database update logic.&lt;/li&gt;
&lt;li&gt;For now, we’re going to simply write to the debug console in Visual Studio.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Diagnostics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commands&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;Paramore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Brighter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;Domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Handlers&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CreateValueCommandHandler&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token type-list&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;RequestHandler&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;CreateValueCommand&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;CreateValueCommand&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;CreateValueCommand&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            Debug&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;$&quot;Creating Value &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token expression language-csharp&quot;&gt;command&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;command&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6. Add Brighter configuration to the service collection&lt;/h2&gt;
&lt;p&gt;ASP.NET Core uses a service collection as a dependency injection container. We need to use this because in our API Controller we want to use the &lt;code class=&quot;language-text&quot;&gt;CommandProcessor&lt;/code&gt; to create commands. We’ll come onto that next but first we’ll configure ASP.NET to use Brighter.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open &lt;code class=&quot;language-text&quot;&gt;BrighterOnAspNetCore/Startup.cs&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;In the &lt;code class=&quot;language-text&quot;&gt;ConfigureServices&lt;/code&gt; method, add the following lines &lt;em&gt;before&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;.AddMvc()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddBrighter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HandlersFromAssemblies&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token type-expression class-name&quot;&gt;CreateValueCommandHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Assembly&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will add all the Handlers in the same assembly as our &lt;code class=&quot;language-text&quot;&gt;CreateValueCommandHandler&lt;/code&gt; to the ASP.NET Core dependency injection container, and perform some default setup. See &lt;a href=&quot;https://github.com/brainwipe/Paramore.Brighter.AspNetCore&quot;&gt;Paramore.Brighter.AspNetCore&lt;/a&gt; for the options that are available.&lt;/p&gt;
&lt;h2&gt;7. Add Command Processor into our controller and create a command&lt;/h2&gt;
&lt;p&gt;Commands are all about changing the data in your system, not getting it.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Open &lt;code class=&quot;language-text&quot;&gt;BrighterOnAspNetCore/Controllers/ValuesController.cs&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;At the top of the Controller class create the following member variable and constructor:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IAmACommandProcessor&lt;/span&gt; commandProcessor&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ValuesController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;IAmACommandProcessor&lt;/span&gt; commandProcessor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;commandProcessor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; commandProcessor&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The interface &lt;code class=&quot;language-text&quot;&gt;IAmCommandProcessor&lt;/code&gt; will have been registered with the ASP.NET Core dependency injection in the last step. When the controller is instantiated, it will be injected in, ready built and filled with handlers, ready to use.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;In the &lt;code class=&quot;language-text&quot;&gt;Post()&lt;/code&gt; method, create value command and send it to the &lt;code class=&quot;language-text&quot;&gt;commandProcessor&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;csharp&quot;&gt;&lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// POST api/values&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HttpPost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{value}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token return-type class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;/span&gt; command &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token constructor-invocation class-name&quot;&gt;CreateValueCommand&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    commandProcessor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;command&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the simplest thing that works; it would be better for the new value we’re posting to the service to be in the Body but for that we would need to introduce JSON and a model or a text/plain formatter. For simplicity sake, we’ll grab it from the URL instead.&lt;/p&gt;
&lt;h2&gt;Testing the service&lt;/h2&gt;
&lt;p&gt;Run the application and then use as HTTP test client (I like &lt;a href=&quot;https://www.getpostman.com/&quot;&gt;Postman&lt;/a&gt; but curl would do!) to POST a request to: &lt;code class=&quot;language-text&quot;&gt;http://localhost:58484/api/values/helloworld&lt;/code&gt;, where &lt;code class=&quot;language-text&quot;&gt;localhost:58484&lt;/code&gt; is root of your website and &lt;code class=&quot;language-text&quot;&gt;helloworld&lt;/code&gt; is the data you’re sending.&lt;/p&gt;
&lt;p&gt;In the Visual Studio Output window, set “Show Output From” to Debug and you should see &lt;code class=&quot;language-text&quot;&gt;Creating value helloworld&lt;/code&gt;. This means that the Command has moved through Brighter and Handled by your command Handler.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Adding an nginx container for static files in my VS2017 solution]]></title><description><![CDATA[I am using Visual Studio with a docker-compose project to handle the building and running of my docker instances. I want the developer to…]]></description><link>https://brainwipe.github.io/2017-07-28-nginx-vs-docker-compose/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-07-28-nginx-vs-docker-compose/</guid><pubDate>Fri, 28 Jul 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I am using Visual Studio with a docker-compose project to handle the building and running of my docker instances. I want the developer to download the repository, hit F5 and for it to just work. I already have a few linux containers running aspnetcore projects and now I wanted a simple container to serve static files. The static file I needed was a simple HTML page that would call an authentication API. I call it &lt;em&gt;mcotestclient&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;This is the journey I had and the problems I found.&lt;/p&gt;
&lt;h2&gt;Dockerfile for the new container&lt;/h2&gt;
&lt;p&gt;I decided to use a super-light linux container (which is inline with the brief of our solution) and decided on &lt;a href=&quot;https://www.nginx.com/resources/wiki/&quot;&gt;nginx&lt;/a&gt; as the web server to hand the static files. To add a new container, I began with a new solution folder with an HTML file (&lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt;) and a Dockerfile:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM nginx:alpine
COPY . /usr/share/nginx/html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This Dockerfile gets the nginx docker image, which is in turn built upon a super lightweight &lt;a href=&quot;https://alpinelinux.org/&quot;&gt;Alpine&lt;/a&gt; Linux distribution. It then copies the contents of the folder (just my boring &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt;) into &lt;code class=&quot;language-text&quot;&gt;/user/share/nginx/html&lt;/code&gt;, which is the default location.&lt;/p&gt;
&lt;p&gt;The Dockerfile only creates a new image, to have a new instance run, we need to add a new service to the &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; file.&lt;/p&gt;
&lt;h2&gt;Adding a new container to docker-compose&lt;/h2&gt;
&lt;p&gt;In my docker-compose project, I opened &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; and added a new image:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;services:
    [snip my other containers]

    mcotestclient:
        image: mcotestclient
        build: 
            context: ./Client
            dockerfile: Dockerfile
        ports:
        - 56108:80
        networks:
        - mconetwork&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;mco&lt;/code&gt; is our company prefix, the folder where &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt; and the Dockerfile was located is &lt;code class=&quot;language-text&quot;&gt;./Client&lt;/code&gt; and I want it to run on port &lt;code class=&quot;language-text&quot;&gt;56108&lt;/code&gt; so that when I go to &lt;code class=&quot;language-text&quot;&gt;http://localhost:56108&lt;/code&gt; I see my index page.&lt;/p&gt;
&lt;h2&gt;First error: Can not find label com.microsoft.visualstudio.targetoperatingsystem&lt;/h2&gt;
&lt;p&gt;I built the solution and got the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Error	MSB4018	The &quot;PrepareForBuild&quot; task failed unexpectedly.
System.InvalidOperationException: Can not find label &apos;com.microsoft.visualstudio.targetoperatingsystem&apos;.
at Microsoft.DotNet.Docker.DockerServiceDebugProfileProvider.GetLabelValue(IReadOnlyDictionary`2 labels, String labelName, Boolean required)
at Microsoft.DotNet.Docker.DockerServiceDebugProfileProvider.ParseDockerServiceDebugProfiles(String workspaceName, DockerComposeDocument document)
at Microsoft.DotNet.Docker.DockerWorkspace.&amp;lt;GetDockerServiceDebugProfilesAsync&gt;d__12.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
at Microsoft.DotNet.Docker.DockerWorkspace.&amp;lt;PrepareForBuildAsync&gt;d__13.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
at Microsoft.DotNet.Docker.BuildTasks.DockerBaseTask.Execute()
at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()
at Microsoft.Build.BackEnd.TaskBuilder.&amp;lt;ExecuteInstantiatedTask&gt;d__26.MoveNext()	docker-compose	C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\MSBuild\Microsoft\VisualStudio\v15.0\Docker\Microsoft.VisualStudio.Docker.Compose.targets	153	&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The most important line is that &lt;code class=&quot;language-text&quot;&gt;Can not find label &apos;com.microsoft.visualstudio.targetoperatingsystem&apos;&lt;/code&gt;. This means that Visual Studio needs to know what the operating system is. In your docker-compose project, click the little triangle next to &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; and you’ll see that there are a number of additional files that Visual Studio needs. Open &lt;code class=&quot;language-text&quot;&gt;docker-compose.vs.debug.yml&lt;/code&gt;. I needed to put in a new entry in there to tell it what the target operating system was for my new image:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mcotestclient:
    image: mcotestclient:dev
    labels:
    - &quot;com.microsoft.visualstudio.targetoperatingsystem=linux&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Second Error - no such file or directory /bin/bash&lt;/h2&gt;
&lt;p&gt;For the second error, the Error window showed that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Error	MSB4018	The &quot;PrepareForBuild&quot; task failed unexpectedly.
Microsoft.DotNet.Docker.CommandLineClientException: .

For more troubleshooting information, go to http://aka.ms/DockerToolsTroubleshooting ---&gt; Microsoft.DotNet.Docker.CommandLineClientException
at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
at Microsoft.DotNet.Docker.DockerClient.&amp;lt;ExecuteAsync&gt;d__0.MoveNext()
--- End of inner exception stack trace ---
at Microsoft.DotNet.Docker.DockerClient.&amp;lt;ExecuteAsync&gt;d__0.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
at Microsoft.DotNet.Docker.DockerWorkspace.&amp;lt;PrepareForBuildAsync&gt;d__13.MoveNext()
--- End of stack trace from previous location where exception was thrown ---
at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
at Microsoft.DotNet.Docker.BuildTasks.DockerBaseTask.Execute()
at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()
at Microsoft.Build.BackEnd.TaskBuilder.&amp;lt;ExecuteInstantiatedTask&gt;d__26.MoveNext()	docker-compose	C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\MSBuild\Microsoft\VisualStudio\v15.0\Docker\Microsoft.VisualStudio.Docker.Compose.targets	153	&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is Visual Studio telling us that something happened on the command line and it doesn’t know how to deal with it. In this case, go to the Visual Studio Output window, ensure you’ve got Build selected in the drop down at the top and scroll up to the line about that stack trace, you’ll see the actual commands it was trying to run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[snip]
docker  ps --filter &quot;status=running&quot; --filter &quot;name=dockercompose320715364_mcotestclient_&quot; --format {% raw %}{{.ID}}{% endraw %} -n 1
2&gt;ab666c689e17
2&gt;docker  exec -i ab666c689e17 /bin/bash -c &quot;if PID=$(pidof -x dotnet); then kill $PID; fi&quot;
2&gt;rpc error: code = 2 desc = oci runtime error: exec failed: container_linux.go:262: starting container process caused &quot;exec: \&quot;/bin/bash\&quot;: stat /bin/bash: no such file or directory&quot;
2&gt;C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\MSBuild\Microsoft\VisualStudio\v15.0\Docker\Microsoft.VisualStudio.Docker.Compose.targets(153,5): error MSB4018: The &quot;PrepareForBuild&quot; task failed unexpectedly.
2&gt;C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\MSBuild\Microsoft\VisualStudio\v15.0\Docker\Microsoft.VisualStudio.Docker.Compose.targets(153,5): error MSB4018: Microsoft.DotNet.Docker.CommandLineClientException: .
[snip]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At the boittom I’ve included the first two lines of the stack trace to show you what it looks like. The docker-compose project uses MSBuild to run the docker commands for you. At the top you can see that it first needs the process ID of an existing &lt;em&gt;mcotestclient&lt;/em&gt; container, which is &lt;code class=&quot;language-text&quot;&gt;ab666c689e17&lt;/code&gt; and then it passes it to an &lt;code class=&quot;language-text&quot;&gt;exec&lt;/code&gt; command. That exec command attaches to the running container and kills the dotnet process inside (there isn’t one but it doesn’t know that). However, this fails. The next line says that the exec failed because &lt;code class=&quot;language-text&quot;&gt;/bin/bash&lt;/code&gt; does not exist. That folder isn’t there because bash isn’t there.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;BASH NOT EXIST? BUT THIS IS LINUX!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;No, this is Alpine Linux, which doesn’t have bash. The Visual Studio compose file assumes that every Linux container has bash on it. Not unreasonable but not right.&lt;/p&gt;
&lt;h3&gt;Options: install bash or change the base image&lt;/h3&gt;
&lt;p&gt;A change needs to be made to my super light Dockerfile, which currently looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM nginx:alpine
COPY . /usr/share/nginx/html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Either add bash to Alpine like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM nginx:alpine
RUN apk update &amp;amp;&amp;amp; apk add bash
COPY . /usr/share/nginx/html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or choose the default container:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM nginx
COPY . /usr/share/nginx/html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As I wanted simplicity and that this would not be a production container, I went with the default container.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NB: Make sure you clean, rebuild and run the solution, else the change will not be picked up!&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[.NET Uri class cheatsheet]]></title><description><![CDATA[The Uri class in .NET contains methods for getting at parts of the Uri. In your ASP.NET MVC project you can get the current URL from within…]]></description><link>https://brainwipe.github.io/2017-06-21-dotnet-uri-cheatsheet/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-06-21-dotnet-uri-cheatsheet/</guid><pubDate>Wed, 21 Jun 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;The &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/system.uri.aspx/&quot;&gt;Uri&lt;/a&gt; class in .NET contains methods for getting at parts of the Uri. In your ASP.NET MVC project you can get the current URL from within a Controller using:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; Uri currentUrl = Request.Url;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From this object you can then get lots of information about the current URL. I find that each time I use it, I have to look up which method gives what. Here is a quick cheatsheet for the methods and properties:&lt;/p&gt;
&lt;p&gt;For the URL: &lt;a href=&quot;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&quot;&gt;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&lt;/a&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Uri Property&lt;/th&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AbsolutePath&lt;/td&gt;
&lt;td&gt;/brainwipe/NJsonApiCore/search&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AbsoluteUri&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&quot;&gt;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Authority&lt;/td&gt;
&lt;td&gt;github.com&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DnsSafeHost&lt;/td&gt;
&lt;td&gt;github.com&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fragment&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Host&lt;/td&gt;
&lt;td&gt;github.com&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;HostNameType&lt;/td&gt;
&lt;td&gt;Dns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IsAbsoluteUri&lt;/td&gt;
&lt;td&gt;True&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IsDefaultPort&lt;/td&gt;
&lt;td&gt;True&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IsFile&lt;/td&gt;
&lt;td&gt;False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IsLoopback&lt;/td&gt;
&lt;td&gt;False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IsUnc&lt;/td&gt;
&lt;td&gt;False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LocalPath&lt;/td&gt;
&lt;td&gt;/brainwipe/NJsonApiCore/search&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OriginalString&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&quot;&gt;https://github.com/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PathAndQuery&lt;/td&gt;
&lt;td&gt;/brainwipe/NJsonApiCore/search?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Port&lt;/td&gt;
&lt;td&gt;443&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Query&lt;/td&gt;
&lt;td&gt;?utf8=%E2%9C%93&amp;#x26;q=jsonapi&amp;#x26;type=&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Scheme&lt;/td&gt;
&lt;td&gt;https&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Segments&lt;/td&gt;
&lt;td&gt;/ brainwipe/ NJsonApiCore/ search&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UserEscaped&lt;/td&gt;
&lt;td&gt;False&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;UserInfo&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;a href=&quot;https://gist.github.com/brainwipe/845a24fe773186b318a91e51b8b2a916&quot;&gt;C# .net console gist&lt;/a&gt; for generating this output and a &lt;a href=&quot;http://www.tablesgenerator.com/markdown_tables#&quot;&gt;handy Markdown table builder&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[DataGrip - File not found when connecting to LocalDB]]></title><description><![CDATA[Local DB is a lightweight replacement to SQL Express that is installed as part of Visual Studio. It’s free, 100% compatible with SQL Server…]]></description><link>https://brainwipe.github.io/2017-06-19-datagrip-localdb-connect/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-06-19-datagrip-localdb-connect/</guid><pubDate>Mon, 19 Jun 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/sqlexpress/2011/07/12/introducing-localdb-an-improved-sql-express/&quot;&gt;Local DB&lt;/a&gt; is a lightweight replacement to SQL Express that is installed as part of Visual Studio. It’s free, 100% compatible with SQL Server, runs on database up to 10GB of data and you can connect using a connection string.&lt;/p&gt;
&lt;h2&gt;DataGrip&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jetbrains.com/datagrip/&quot;&gt;DataGrip&lt;/a&gt; is a relational database management tool by JetBrains. I’ve found it easier to use for SQL Server, Postgres and MySQL than dedicated tools. Being able to switch tabs, set themes and compare output in a single UI has been really useful on projects where I need to use more than one database engine. It’s not free but there is a 30 day trial, which I urge you to try. Here’s what my UI looks like, setup how I like it:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1c84991752587a82ee2ca991c1db4d95/dca52/datagrip-sqlserver.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACrElEQVQ4y5WSy27bVhBAqdRR7BZN7VhN4dpx0AC2o0ixSPElvkRSfImUKJmyraLfWXTTRRfxK82igd247d+cQmSBOIFQwIuDuTPAPTO4d4Rff/mZ3y8vuDx7w9X5WRnfXpxzdf6Gq4sz3r295N3VZZkv6jfv/+Cf2w8Vf33g79s/ub1+z831NTcXvyGcnMzJixOKk1OmxTHFrOBodszoaMakmJHlU9JxTjjMSoIkxY8S/CDGG4S4C4IINxwyyxKEbDImH4/IspQkm5KOcoIowRlOiZIU2w0ZRDHH8znjRcPTH0nHE7woxI9TvGjIKBgQxEOOYh/heyug6dm0HIWOp7Jv6+zbGi9tlW1jUe9yYGk8lR2eyhYNyeQ72UBOC6zRKe5wiuXFtHQP13EQHqkD1g2LbUdhx5bZclS+NFy2HZWtvs5zV2bTtFnTAta0AcKhyRddh66f0Y9zwvwYMxrTcRIsy0F4bEasKgPqkk+9G7Ii+jySXFZEj4eiy0pnQZ+66LAqVdQlB90dEIcRQRARhTFRnFLEA4RwMqcdTGiGU+T8JzrxmP1+TNuPaHoxz80hB/2QPSfimZGwayRl3LNTDpzsP1Ka/gQrTBHmRc6uE1DvSKzLXb7VJL6RZb7uKmyoCl91ezS0Lo8VFaGlI7Q0hFcqQlP5lJcK64cywmR2yo4TsirKNDSFDUUpY120eKIuzjJPVJk1yeBhx2TlsFdJ71Arm2g0RAUhCiMasl12r7V7JUK7x4O2zoPXJrW2UeWve9VkCz4TCi31ozDxfTbEXjl2raV+vLSMu5JP8kq4uRD6nsemZCA0l3Vewv9MWAoH9xUuZZnwlVo97j2pff4pvuuxLhrlt1frcB/uro1arU0cxezpNluyyY5isX0PdvU+PxgeL0yfZ7pLx7L4F41jETdNrN4WAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;DataGrip themed how I like it&quot;
        title=&quot;DataGrip themed how I like it&quot;
        src=&quot;/static/1c84991752587a82ee2ca991c1db4d95/f058b/datagrip-sqlserver.png&quot;
        srcset=&quot;/static/1c84991752587a82ee2ca991c1db4d95/c26ae/datagrip-sqlserver.png 158w,
/static/1c84991752587a82ee2ca991c1db4d95/6bdcf/datagrip-sqlserver.png 315w,
/static/1c84991752587a82ee2ca991c1db4d95/f058b/datagrip-sqlserver.png 630w,
/static/1c84991752587a82ee2ca991c1db4d95/40601/datagrip-sqlserver.png 945w,
/static/1c84991752587a82ee2ca991c1db4d95/78612/datagrip-sqlserver.png 1260w,
/static/1c84991752587a82ee2ca991c1db4d95/dca52/datagrip-sqlserver.png 1550w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;An error connecting to Local DB&lt;/h2&gt;
&lt;p&gt;When &lt;a href=&quot;https://blog.jetbrains.com/datagrip/2016/10/07/connecting-datagrip-to-sql-server-express-localdb/&quot;&gt;connecting to LocalDB&lt;/a&gt; I often receive the error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[2017-06-19 11:52:50] java.io.FileNotFoundException: \\.\pipe\MSSQL$&amp;lt;pipe name&gt;\sql\query (The system cannot find the file specified)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It also fails in the Test Connection window.&lt;/p&gt;
&lt;h2&gt;LocalDB is not running!&lt;/h2&gt;
&lt;p&gt;LocalDB is significantly different to SQL Server Express in that it is very lightweight and &lt;em&gt;does not run as a service&lt;/em&gt;. It can be started and stopped when needed. What the error above is telling us is that LocalDB has not been started. If you use Visual Studio SQL Server Object Explorer, then the database will appear to be there because Visual Studio know that it needs to run LocalDB. DataGrip doesn’t have a concept of starting LocalDB. Viewing the LocalDB in Visual Studio will solve the DataGrip error because LocalDB will now be running.&lt;/p&gt;
&lt;h2&gt;Command Line with LocalDB&lt;/h2&gt;
&lt;p&gt;LocalDB &lt;a href=&quot;https://docs.microsoft.com/en-us/sql/relational-databases/express-localdb-instance-apis/command-line-management-tool-sqllocaldb-exe&quot;&gt;comes with a command line&lt;/a&gt; called &lt;code class=&quot;language-text&quot;&gt;SqlLocalDB.exe&lt;/code&gt; that can be used from your Windows command prompt.&lt;/p&gt;
&lt;p&gt;Find out what your instances are:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;C:\&gt;sqllocaldb i
MSSQLLocalDB
ProjectsV12
ProjectsV13&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Get detailed information for an instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;C:\&gt;sqllocaldb i projectsv13
Name:               ProjectsV13
Version:            13.0.1601.5
Shared name:
Owner:              MyPCName\Rob
Auto-create:        No
State:              Running
Last start time:    19/06/2017 11:59:28
Instance pipe name: np:\\.\pipe\LOCALDB#C2BC2C23\tsql\query&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that the state there is “Running”.&lt;/p&gt;
&lt;p&gt;Stop a Local DB instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;C:\&gt;sqllocaldb stop projectsv13
LocalDB instance &quot;ProjectsV13&quot; stopped.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Start a local DB instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;C:\&gt;sqllocaldb start projectsv13
LocalDB instance &quot;ProjectsV13&quot; started. &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That is the command line way to rid yourself of the DataGrip problem.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[.NET running on a Linux docker container]]></title><description><![CDATA[In this post I’m going to take you through getting a .NET Core running on Linux docker container. I’m not an expert and will refer back to…]]></description><link>https://brainwipe.github.io/2017-05-23-docker-linux-dotnet/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-05-23-docker-linux-dotnet/</guid><pubDate>Tue, 23 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post I’m going to take you through getting a .NET Core running on Linux docker container. I’m not an expert and will refer back to the Bad Old Days (BOD) a lot.&lt;/p&gt;
&lt;h2&gt;Pre-requisites&lt;/h2&gt;
&lt;p&gt;You might find alternatives to these tools but they are the ones that my team and I use. Before you install, make sure you &lt;a href=&quot;https://docs.docker.com/docker-for-windows/install/#what-to-know-before-you-install&quot;&gt;understand the caveats from docker&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Windows 10 Pro x64, Microsoft Hyper-V&lt;/li&gt;
&lt;li&gt;Visual Studio 2017&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Install Docker for Windows&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/docker-for-windows/install/#download-docker-for-windows&quot;&gt;Download Docker for Windows&lt;/a&gt; I recommend the stable channel. I used the defaults for everything, I suggest you do too!&lt;/p&gt;
&lt;p&gt;Once docker for Windows is installed, find the docker whale icon in the status bar right click and choose &lt;code class=&quot;language-text&quot;&gt;Settings...&lt;/code&gt;. On the left of the settings window, choose &lt;code class=&quot;language-text&quot;&gt;Shared Drives&lt;/code&gt; and tick the box for &lt;code class=&quot;language-text&quot;&gt;C:&lt;/code&gt;. This will give the docker machine access to the files on the &lt;code class=&quot;language-text&quot;&gt;C:&lt;/code&gt; drive, which is doesn’t have by default.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACTUlEQVQ4y52STWsTURSGZ+dGwQ/w57hQUBH/hiux6kbUXam6kO5cKFI/skiq1o0bMaZQsBSKttNiVWI/kmYmmUw+J5PJZDKZufPIvWlskYLigYeXOXfOO+ecO5plmnhOCxEGxANfaRJHIGISESuViGiIiKPfmhyAaAAI+tYO2lp+h7XtMvlyg+9GnXKrS7vdplAoYBgGxWIRy6pyWIgkUbr+bZOnr+YJGjW09OIPUot50svbpL8YfNpq0HU7mKZJ1bJoNps4jkOn06HrurRaLTzPU0bJnmFmocKDOQO/aqAZu0VKhqEKZKHv+wwGA1XU7XaJogghBHEcK+SzVJmTJELg+QHdAYT1EppZ2qVareJ5XVzXpd/vE4ZDbLtGEAyIopjhMFJIszAMaTuO0mEk80PiaIjstWcV0WyrQqvdVt3ILmWHsgNZEMeCf4nx6L40rBgl6vWGMpJjjg0Pvvx3xL6hsVvANMtqbMnYcLSjZG9/glgcQjwmRoxHrlbK1Op1bNtWKEOR8D8R2CU0q2zS6bj0ej06rgsi4m12hSt3nzAxOcPN+yluPUxzZ3p2jwy3pzMqNzH1guv3XnJt8hlXp1L8XNfRPEdeiKv+vVazqb50Y+o52pEzaKcvoZ04P+LUxREnJRdGuaNn0Y6dQzsuzy+z8CGHZjsN2p6P4/l0eoHahb5VZ+bdZ1LvdWazOm9yOq8/rv6Bztz8GnM5nceZLI9mc1R2ttC2V7KY+qLC3limlV8lKG8S2QVCqwC1AjQPobFPY2OJ6tcl2qvz/ALIF6cBdQNpfAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Docker Settings window showing the shared drive and the C drive ticked&quot;
        title=&quot;The Docker Settings window showing the shared drive and the C drive ticked&quot;
        src=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png&quot;
        srcset=&quot;/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/c26ae/docker-settings-share-drive.png 158w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/6bdcf/docker-settings-share-drive.png 315w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/f058b/docker-settings-share-drive.png 630w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/40601/docker-settings-share-drive.png 945w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/78612/docker-settings-share-drive.png 1260w,
/static/0b2d1cc0bf13b1d7b892daaa9809fe6b/1e1c3/docker-settings-share-drive.png 1670w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Why did I need Hyper-V?&lt;/h2&gt;
&lt;p&gt;That was a question I found myself asking at first. Where Docker is the application that is running in your system tray, the virtual machine that hosts the actual docker container is in Hyper-V. Let’s have a look at that.&lt;/p&gt;
&lt;p&gt;In Windows hit the windows key and type &lt;code class=&quot;language-text&quot;&gt;Hyper-V&lt;/code&gt; to get the Hyper-V Manager. You’ll see this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1533b470897f6f55826751f12491ab25/d438d/hyper-v-docker.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAB2HAAAdhwGP5fFlAAABmUlEQVQoz41S2Y7bMAz0/39YX9uXomjSBRI7tmVZt+Tb0hQUkqwTFNgSGFAcUENSVMFZC8E79NJiX1cgRsR9Q9zu2N+wfXrEHUgRiBviOiOuC4rvH1f8/LjidNMw1uFa3cCFhDYWShsIpSHvnvDgtLWoGobzpUbFFMpWomISxY334GbAukVIrXE6n6GkeEIrCdFztE2dYykFnDWYxoDztca3H7/x69LhT2NwKgWKOXg8LAwDfAiYpgkrjf+F2RByEW8NgJS5Inj3TBjHEdM0Y1kW7Pv+paCyBrzvwXmPZVmRUkIxHASdc6jKEoy14Jzn8ZSUUEpB0ehCwBiNcRxyccEZeNflBsj+IWhRlhdoLWG0yuAdQ32r0LE2x9YoOGfgvUPHajRNjXme8/0Y46sgVX0flaqmmLI/cmRSO/gwPDm6+yJojAFrG3hnYY3O26SuOtbkbVNsLfEPOMSYPgu/j0zbpbaPCYRt2zN/5Ag0akrEHwTHw7chwf0u+D82z8vLU+Rvo6XAvCy5mvc+vyOdSfwrhBByLm35gb/q26IMOX3T1AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Hyper-V manager with one VM running&quot;
        title=&quot;The Hyper-V manager with one VM running&quot;
        src=&quot;/static/1533b470897f6f55826751f12491ab25/f058b/hyper-v-docker.png&quot;
        srcset=&quot;/static/1533b470897f6f55826751f12491ab25/c26ae/hyper-v-docker.png 158w,
/static/1533b470897f6f55826751f12491ab25/6bdcf/hyper-v-docker.png 315w,
/static/1533b470897f6f55826751f12491ab25/f058b/hyper-v-docker.png 630w,
/static/1533b470897f6f55826751f12491ab25/40601/hyper-v-docker.png 945w,
/static/1533b470897f6f55826751f12491ab25/78612/hyper-v-docker.png 1260w,
/static/1533b470897f6f55826751f12491ab25/d438d/hyper-v-docker.png 2290w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;There’s only one Virtual Machine (VM) running called &lt;strong&gt;MobyLinuxVM&lt;/strong&gt;. It’s called Moby because docker is now a trademark used by the support company and &lt;a href=&quot;https://blog.docker.com/2017/04/introducing-the-moby-project/&quot;&gt;Moby&lt;/a&gt; is the name given to the open source bit. Moby Linux is an alpine distro of Linux with addition to allow communication between the virtual machine and Hyper-V.&lt;/p&gt;
&lt;p&gt;The default IP of the docker host virtual machine is 10.0.75.1. That will come in useful later.&lt;/p&gt;
&lt;h2&gt;New ASP.NET Core Project&lt;/h2&gt;
&lt;p&gt;Open up Visual Studio 2017 and create an ASP.NET Core Web Application. Select &lt;code class=&quot;language-text&quot;&gt;Enable Docker Support&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f1a727cee004332a2abe8b85d52fc77d/098c1/aspnet-core-with-docker.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABw0lEQVQ4y42Ti27aMBSG8/7PRrspAUbT0ULsOI5zsx07LeLyT+cMaMuoNEu/TmTH37k6MXKDUmxhqhK6FKikhFYlulqjVpL3Wl1hNwXW/n3CYff2RbRHZ8ENSOT2Fa+bDcpSoe16FPWAIbxjmiaEEBHjhBAj/DjCeY+q0hBCQkoJIc9WCGit+TyhyBaLBfq+x3K5RNsYGFMjxgicTjgejyxau90O8yzFz8dHZFmGNE0xzzJkacoMVSok0VsUQuBwOOA5f0YIAbPZDMYYhpxOJ9YFuN4q5C8CbdtyEBd1XcdiIP3+OYqqquC9vwtse4t+cLDW3lUyeXe9eLsue5+Bw9DDDgOGb/QFeKt7ETrnOHoSff8DpJS/A97CL+WQ5+7Wdc3gLym/jR7/u/b7PTeOOkzK85yh1IxrhH1TwzkPT6k4ixhGTDH+ncEQuOvjOLKlFJVSPLNk1+v1GWoYRt1O6DWQt4cfKR6yHPN8g61Q0FUFpQ20aXhEmrZlSxcJfKklOaNUrxHatuGwi0JAlAqFKHku+QXoDlXTny/Y+53l2rmrk4+U/Tlt/9FFKoEj2M2sEcjagZ08vRT49XuD1WqFp9UKfwDn7NwwXSSCowAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Creating a new ASP.NET Core project with docker support&quot;
        title=&quot;Creating a new ASP.NET Core project with docker support&quot;
        src=&quot;/static/f1a727cee004332a2abe8b85d52fc77d/f058b/aspnet-core-with-docker.png&quot;
        srcset=&quot;/static/f1a727cee004332a2abe8b85d52fc77d/c26ae/aspnet-core-with-docker.png 158w,
/static/f1a727cee004332a2abe8b85d52fc77d/6bdcf/aspnet-core-with-docker.png 315w,
/static/f1a727cee004332a2abe8b85d52fc77d/f058b/aspnet-core-with-docker.png 630w,
/static/f1a727cee004332a2abe8b85d52fc77d/40601/aspnet-core-with-docker.png 945w,
/static/f1a727cee004332a2abe8b85d52fc77d/78612/aspnet-core-with-docker.png 1260w,
/static/f1a727cee004332a2abe8b85d52fc77d/098c1/aspnet-core-with-docker.png 1578w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once complete, you can run it straight away by pressing F5. You’ll notice that the output window from the build has lots more output in it. That’s the docker compose system.&lt;/p&gt;
&lt;p&gt;If you need to add docker support to an existing solution, you can do that by adding the docker compose project&lt;/p&gt;
&lt;h2&gt;Target process exited without raising a CoreCLR started event&lt;/h2&gt;
&lt;p&gt;At first I saw this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f16cc92492103016b7cb0bf67e563ca4/0955e/netcore-did-not-start.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAB2HAAAdhwGP5fFlAAABN0lEQVQoz52R2W6DQAxF+dT+Zb+hT5GqZgOFpTMwgSSFUGAWllNB2r5UVRdLR5avLcu69oo44CjihVwkZHHIKRUMuqHvXr8wfKO5tqaUB7yuLtF2QBuDsXbJ1jn+E6Yu8SbXw1QxjT3WWozRmHn5O23bLmh906016K6jaRq07ui6mZZhHBm7Gm+0PXVyR3u+xw8yNpsndrsdvu+zXq/Z7/cEQUAURey2WzabLYfDgTAMbz3fX/qn84XJNHizV/QCpwtkqsiPCiEEUkqEkKj3WqnjokmZUhQFl/OZPM/JsmypXT8wtMuF+mdzpt95uCw0TY3rHc5ZnHN/Yn6etnPuMW5AXy94L7mirK6UZfknqqrCTxSrtc/D6onHICGJYryXQlFdr59Dv+FjVh5PhM8pQZQQpzlKPPMGunSvsVEQtwEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Process exited without raising a CoreCLR started event&quot;
        title=&quot;Process exited without raising a CoreCLR started event&quot;
        src=&quot;/static/f16cc92492103016b7cb0bf67e563ca4/f058b/netcore-did-not-start.png&quot;
        srcset=&quot;/static/f16cc92492103016b7cb0bf67e563ca4/c26ae/netcore-did-not-start.png 158w,
/static/f16cc92492103016b7cb0bf67e563ca4/6bdcf/netcore-did-not-start.png 315w,
/static/f16cc92492103016b7cb0bf67e563ca4/f058b/netcore-did-not-start.png 630w,
/static/f16cc92492103016b7cb0bf67e563ca4/0955e/netcore-did-not-start.png 901w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In Visual Studio check the Debug output window for the reason why:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;realpath(): Invalid argument
The specified framework &apos;Microsoft.NETCore.App&apos;, version &apos;1.1.2&apos; was not found.
  - Check application dependencies and target a framework version installed at: /usr/share/dotnet/shared/Microsoft.NETCore.App
  - The following versions are installed:
  1.1.1
  - Alternatively, install the framework version &apos;1.1.2&apos;.
The program &apos;&apos; has exited with code 131 (0x83).&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Installing the latest version of .NET Core will solve this problem but why is it happening? Let’s look at…&lt;/p&gt;
&lt;h2&gt;The Dockerfile&lt;/h2&gt;
&lt;p&gt;In your ASP.NET Core project you’ll find a Dockerfile (no file extension). The Dockerfile is a build file for creating a docker image. Each line is a command. It will look a little like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM microsoft/aspnetcore:1.1
ARG source
WORKDIR /app
EXPOSE 80
COPY ${source:-obj/Docker/publish} .
ENTRYPOINT [&quot;dotnet&quot;, &quot;AspNetCoreInDocker.dll&quot;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first line &lt;code class=&quot;language-text&quot;&gt;microsoft/aspnetcore:1.1&lt;/code&gt; is the base image. The name breaks down as &lt;code class=&quot;language-text&quot;&gt;[maintainer]/[image]:[tag]&lt;/code&gt;. So this is an image that’s maintained by Microsoft, has ASP.NET Core on it and has the version tag of 1.1. You can find all the tags on the &lt;a href=&quot;https://hub.docker.com/r/microsoft/aspnetcore/&quot;&gt;Docker Hub page for this image&lt;/a&gt;. You can use &lt;code class=&quot;language-text&quot;&gt;FROM microsoft/aspnetcore:latest&lt;/code&gt; to get yourself running. (&lt;a href=&quot;https://stackoverflow.com/questions/44134429/why-does-latest-aspnet-core-docker-image-run-when-the-tag-1-1-fails&quot;&gt;I’ve started a Stack Overflow question to understand why&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Run the solution again and a browser window will open with the default ASP.NET Core project being shown. .NET is now running in a Linux docker container on a Linux host.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A .NET codger getting into Linux on Windows]]></title><description><![CDATA[Running .NET through Visual Studio with Microsoft SQL Server and onto a Windows Server instance has been that comfortable jumper for many…]]></description><link>https://brainwipe.github.io/2017-05-17-linux-wsl/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-05-17-linux-wsl/</guid><pubDate>Wed, 17 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Running .NET through Visual Studio with Microsoft SQL Server and onto a Windows Server instance has been that comfortable jumper for many years. As much as the landscape changed from Web Forms to MVC, stored procedures to Entity Framework, you still had that sense of familiarity that Microsoft won’t let you down. That rubber stamp of Microsoft quality has been an easy sell. You could say:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We’re a Microsoft shop&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and even if you didn’t have any certification, clients would know that the company you worked for did things properly. Choosing a new Microsoft technology to plug into it meant that no questions would be asked.&lt;/p&gt;
&lt;p&gt;That’s all changed. If you feel stitched into the comfy Microsoft jumper, it’s time to look beyond it because of &lt;em&gt;cost&lt;/em&gt;. A Windows Server instance is expensive. A SQL Server instance is expensive (especially if you need database level encryption). Visual Studio is expensive. I’m very productive with Visual Studio and .NET so I want to keep using those but I find it more difficult to justify the cost. There is quality elsewhere, the world is moving on and so is Microsoft.&lt;/p&gt;
&lt;h2&gt;Getting into Linux&lt;/h2&gt;
&lt;p&gt;Before you defenstrate your Windows 10 box with a sharp toe punt, you’ll be pleased to read that you can learn Linux from within the comfort of your own Windows environment. Microsoft have embedded Linux into something called the Windows Subsystem for Linux (WSL) since the “Anniversary Update”. You could do this with a VM but that would take lots of extra resources and you can run Windows programs side-by-side. It’s free but a bit of a pain to get it running:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://msdn.microsoft.com/en-us/commandline/wsl/install_guide&quot;&gt;WSL Installation Instructions&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Useful things about the WSL&lt;/h2&gt;
&lt;p&gt;The WSL (at time of writing) runs &lt;a href=&quot;http://releases.ubuntu.com/14.04/&quot;&gt;Ubuntu 14.04&lt;/a&gt;. This is a Linux distribution (distro), which is a whole operating system made up from the Linux kernal and a package manager. Packages are tiny little applications and libraries. The bare distro might not have many packages on it but it. As you use your WSL more, you’ll find that you’re installing packages a lot.&lt;/p&gt;
&lt;p&gt;Once you have the WSL running, check out the version you’re on:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ lsb_release -a&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;You can update all the packages by:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ sudo apt-get update&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sudo&lt;/code&gt; means that the command will run with super user priviledges (it’s short for &lt;strong&gt;s&lt;/strong&gt;per &lt;strong&gt;u&lt;/strong&gt;ser &lt;strong&gt;do&lt;/strong&gt;). &lt;code class=&quot;language-text&quot;&gt;apt-get&lt;/code&gt; is the name of the package manager for Ubuntu (and Debian) distros. And &lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt; is the command itself. &lt;code class=&quot;language-text&quot;&gt;apt-get&lt;/code&gt; will run off to its preferred repository and download the latest packages. If there are any updates available, it will tell you each time you run it.&lt;/p&gt;
&lt;p&gt;The command window you’re typing into (also called a shell) uses a scripting language called bash. Bash is super-powerful but doesn’t look like batch or Powershell, so it’s a new skill to learn.&lt;/p&gt;
&lt;h3&gt;Where is the C drive?&lt;/h3&gt;
&lt;p&gt;The C drive is “mounted”. You can use &lt;kbd&gt;tab&lt;/kbd&gt; for autocomplete on longer folder names.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ cd /mnt/c&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Linux is case sensitive!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Can I run my windows programs?&lt;/h3&gt;
&lt;p&gt;Yes, although it will spawn the program in Windows normally as if you had use cmd. Try running dear old notepad:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ /mnt/c/Windows/System32/notepad.exe&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Path variables and command prompt customisation&lt;/h2&gt;
&lt;p&gt;I’m a sucker for having things just so. I have a &lt;a href=&quot;https://github.com/brainwipe/scripts&quot;&gt;scripts git repository&lt;/a&gt; that I’m building up and I want a path to the cloned repository on my local machine. To do that you need to edit a file called &lt;code class=&quot;language-text&quot;&gt;.bashrc&lt;/code&gt;, which is a shell script that is run when the shell first starts.&lt;/p&gt;
&lt;p&gt;You can edit it using &lt;a href=&quot;https://www.howtogeek.com/howto/42980/the-beginners-guide-to-nano-the-linux-command-line-text-editor/&quot;&gt;nano&lt;/a&gt; (there are many others) like this:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$ nano ~/.bashrc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;~/&lt;/code&gt; is a shortcut for saying “the current users home directory”, which is not the Windows one but instead located in &lt;code class=&quot;language-text&quot;&gt;/home/username&lt;/code&gt; such as &lt;code class=&quot;language-text&quot;&gt;/home/brainwipe&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There’s a bunch of stuff in &lt;code class=&quot;language-text&quot;&gt;.bashrc&lt;/code&gt; to begin with, you can add more at the bottom. I can add new paths like this:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PATH=$PATH:/mnt/c/Projects/brainwipe/scripts/bash&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;As the &lt;code class=&quot;language-text&quot;&gt;PATH&lt;/code&gt; variable is a big, long single string (like it used to be shown in Windows), you are actually appending your new path (in this case &lt;code class=&quot;language-text&quot;&gt;/mnt/c/Projects/brainwipe/scripts/bash&lt;/code&gt;) onto the existing variable &lt;code class=&quot;language-text&quot;&gt;$PATH&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The other thing I like to change is the command prompt. I like to have the time and working directory. That’s just another line in the &lt;code class=&quot;language-text&quot;&gt;.bashrc&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;export PS1=&quot;\t \w &gt;&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Will give: &lt;code class=&quot;language-text&quot;&gt;13:36:36 /mnt/c/Projects &gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PS1&lt;/code&gt; stands for &lt;em&gt;Prompt String One&lt;/em&gt;. You can find loads of example of prompt coolness on [make tech easier]&lt;a href=&quot;https://www.maketecheasier.com/8-useful-and-interesting-bash-prompts/&quot;&gt;https://www.maketecheasier.com/8-useful-and-interesting-bash-prompts/&lt;/a&gt;) and all over the web!&lt;/p&gt;
&lt;h2&gt;Further Reading&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://msdn.microsoft.com/en-us/commandline/wsl/faq&quot;&gt;Microsoft WSL FAQ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Pulling Jekyll teeth on the Windows Subsystem for Linux]]></title><description><![CDATA[As I use more open source frameworks and tools, I’ve found that I’ve been writing down documentation that isn’t just useful to business. So…]]></description><link>https://brainwipe.github.io/2017-05-16-pulling-jekyll-teeth/</link><guid isPermaLink="false">https://brainwipe.github.io/2017-05-16-pulling-jekyll-teeth/</guid><pubDate>Tue, 16 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As I use more open source frameworks and tools, I’ve found that I’ve been writing down documentation that isn’t just useful to business. So I decided to start a new dev blog. I checked out Wordpress and I’ve used Blogger before but I decided that static pages were the way to go, using the excellent &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub pages&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;GitHub will host your pages for you, all you have to do is go through the steps on the &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub pages&lt;/a&gt; site, clone the repo locally, add your web pages, push them back up and off you go. In the simplest form, that’s very neat but it suffers from the problem that the blog posts are all mixed up with the markup. If you want to change the look and feel of your site, you’re stuck.&lt;/p&gt;
&lt;h2&gt;Enter Jekyll&lt;/h2&gt;
&lt;p&gt;Jekyll is a Ruby that transforms your markdown blog text into lovely static HTML pages. You create your blog post, run it through Jekyll, check it looks OK and then push the result to GitHub. It’s a great idea, I wanted to use it.&lt;/p&gt;
&lt;p&gt;I’m new to Linux so I thought I’d use this as a way of learning more about the
&lt;a href=&quot;https://msdn.microsoft.com/en-us/commandline/wsl/install_guide&quot;&gt;Windows Subsystem for Linux&lt;/a&gt; (WSL). Jekyll isn’t officially supported on Windows, so I thought it was a good omen to fire up the WSL.&lt;/p&gt;
&lt;p&gt;The Jekyll website was so sure of itself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Get up and running in &lt;em&gt;seconds&lt;/em&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nonsense. Getting Jekyll to work was a hateful experience. Before you jump on your hate keyboard to point out that a lot of the problem I had were Ubuntu based, I didn’t know that when I started and Jekyll failed to tell me.&lt;/p&gt;
&lt;h2&gt;Pre-requisites&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;I already have WSL installed on my machine [instructions][windows-wsl]. It uses Ubuntu 14.04.4.&lt;/li&gt;
&lt;li&gt;I have already gone through the &lt;a href=&quot;https://pages.github.com/&quot;&gt;Github Pages&lt;/a&gt; and cloned locally.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Installing Jekyll&lt;/h2&gt;
&lt;p&gt;Naively, I put in the first command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ gem &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; jekyll bundler
ERROR:  While executing gem &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Gem::FilePermissionError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    You don&apos;t have &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt; permissions into the /var/lib/gems/1.9.1 directory.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Firstly, I notice that it’s trying to install to the gems directory of 1.9.1. Is that the Ruby version or the gems version?I went hunting and found that I didn’t have the &lt;a href=&quot;https://jekyllrb.com/docs/installation/#requirements&quot;&gt;requirements&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ruby 2.0+&lt;/li&gt;
&lt;li&gt;RubyGems&lt;/li&gt;
&lt;li&gt;Make&lt;/li&gt;
&lt;li&gt;GCC&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ah, so my Linux distro isn’t complete enough. I start off by installing &lt;a href=&quot;https://gcc.gnu.org/&quot;&gt;GCC&lt;/a&gt; and Make.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; gcc
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It seems odd that Jekyll needs a compiler and make tool to work. Jekyll assured me that this is easy, so I kept going. So, I noticed that I needed Ruby 2.0, so what version do I have?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ruby &lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which gives:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ruby &lt;span class=&quot;token number&quot;&gt;1.9&lt;/span&gt;.3p484 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2013&lt;/span&gt;-11-22 revision &lt;span class=&quot;token number&quot;&gt;43786&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;x86_64-linux&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;OK, so that’s out of date. I’ll update:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; ruby
Reading package lists&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. Done
Building dependency tree
Reading state information&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. Done
ruby is already the newest version.
The following packages were automatically installed and are no longer required:
  fgetty os-prober
Use &lt;span class=&quot;token string&quot;&gt;&apos;apt-get autoremove&apos;&lt;/span&gt; to remove them.
&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; to upgrade, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; to newly install, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; to remove and &lt;span class=&quot;token number&quot;&gt;144&lt;/span&gt; not to upgrade.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Already the newest version, eh? I think not! It’s over to the &lt;a href=&quot;https://www.ruby-lang.org/en/documentation/installation/#apt&quot;&gt;Ruby Install&lt;/a&gt; page. However Ubuntu’s &lt;code class=&quot;language-text&quot;&gt;apt-get&lt;/code&gt; will only get you as far as version 1.9.3. So how do you get Ruby 2 on Ubuntu 14.04. That sounds like a Stack Overflow question, &lt;a href=&quot;http://stackoverflow.com/q/26595620/328730&quot;&gt;which it is&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Enter rbenv&lt;/h2&gt;
&lt;p&gt;Silly me for thinking that &lt;code class=&quot;language-text&quot;&gt;apt-get&lt;/code&gt; would install Ruby 2. No, I have to use &lt;a href=&quot;https://github.com/rbenv/rbenv&quot;&gt;rbenv&lt;/a&gt;. You have to install a load of pre-requisites (some I already had) and then &lt;code class=&quot;language-text&quot;&gt;git clone&lt;/code&gt; the &lt;code class=&quot;language-text&quot;&gt;rbenv&lt;/code&gt; repository into a folder, add PATH variables and so on.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/a/26595869/328730&quot;&gt;From Stack Overflow answer:&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; git-core &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev

&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/rbenv/rbenv.git ~/.rbenv
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; ~/.bashrc
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;eval &quot;$(rbenv init -)&quot;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; ~/.bashrc
&lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$SHELL&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;export PATH=&quot;$HOME/.rbenv/plugins/ruby-build/bin:$PATH&quot;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; ~/.bashrc
&lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$SHELL&lt;/span&gt;

rbenv &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--verbose&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.4&lt;/span&gt;.1
rbenv global &lt;span class=&quot;token number&quot;&gt;2.4&lt;/span&gt;.1
ruby &lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rbenv install&lt;/code&gt; took several minutes. I added the &lt;code class=&quot;language-text&quot;&gt;--verbose&lt;/code&gt; switch so that I could see it going (others &lt;a href=&quot;http://stackoverflow.com/q/23944406/328730&quot;&gt;had thought it had hung&lt;/a&gt;). The last command &lt;code class=&quot;language-text&quot;&gt;ruby -v&lt;/code&gt; gives me &lt;code class=&quot;language-text&quot;&gt;ruby 2.4.1p111 (2017-03-22 revision 58053) [x86_64-linux]&lt;/code&gt;, which is a relief!&lt;/p&gt;
&lt;p&gt;It’s important to remember that I’m just trying to get Jekyll to run at this point. This is a pre-requisite to a pre-requisite. I was tempted to go back to writing HTML at this point. I’m pretty productive in that, I wrote my first HTML page at the end of 1995. I’m not quite spitting teeth at this point but I’d decided that I was going to blog all this nonsense. Not the first post I wanted to write but that’s blogging for you.&lt;/p&gt;
&lt;h2&gt;Let’s try Jekyll again&lt;/h2&gt;
&lt;p&gt;We have the pre-requisites installed, now to try installing Jekyll and &lt;a href=&quot;http://bundler.io/&quot;&gt;bundler&lt;/a&gt;. Bundler is a way to manage your Ruby gems, a Ruby gem being a library. It works off a Gemfile that greatly simplifies the inclusion and management of Ruby gems.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ gem &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; jekyll bundler
$ jekyll new my-awesome-site&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This worked! I now had Jekyll ready to go. To build and run the site, go to the directory where your Jekyll site is and type:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ jekyll serve&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Theming&lt;/h2&gt;
&lt;p&gt;Jekyll doesn’t theme like other platforms. Rather than download a theme into a theme folder, you replace most of the files with theme files. I grabbed the popular &lt;a href=&quot;https://github.com/poole/hyde&quot;&gt;Hyde&lt;/a&gt; and replaced many of the files. You have to be careful with the &lt;code class=&quot;language-text&quot;&gt;_config.yml&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Gemfile&lt;/code&gt; as these will have settings specific to the theme. I ended up with mash of Gemfile from Hyde and _config from the original new Jekyll site. It was a right mess. Rather than doing Jekyll new, I recommend cloning an existing theme into your GitHub pages folder.&lt;/p&gt;
&lt;p&gt;Once you have the theme down, make sure you use bundler to get the gems that the theme needs.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ bundler&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When that completes, run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ jekyll serve&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It will tell you the port it’s chosen. On WSL, you need to remember that it shares ports with Windows, so you might get a port conflict if you have other sites running elsewhere.&lt;/p&gt;</content:encoded></item></channel></rss>